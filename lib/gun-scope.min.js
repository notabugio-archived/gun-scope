!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("ramda"),require("zalgo-promise")):"function"==typeof define&&define.amd?define("gun-scope",["ramda","zalgo-promise"],e):"object"==typeof exports?exports["gun-scope"]=e(require("ramda"),require("zalgo-promise")):n["gun-scope"]=e(n.ramda,n["zalgo-promise"])}("undefined"!=typeof self?self:this,function(n,e){return function(n){var e={};function t(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=n,t.c=e,t.d=function(n,e,r){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:r})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)t.d(r,o,function(e){return n[e]}.bind(null,o));return r},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=0)}([function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.query=e.scope=e.now=e.nowOr=e.resolve=e.all=e.Promise=void 0;var r=t(1),o=t(2);function u(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=[],r=!0,o=!1,u=void 0;try{for(var i,c=n[Symbol.iterator]();!(r=(i=c.next()).done)&&(t.push(i.value),!e||t.length!==e);r=!0);}catch(n){o=!0,u=n}finally{try{r||null==c.return||c.return()}finally{if(o)throw u}}return t}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(n){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}var c=o.ZalgoPromise;e.Promise=c;var a=o.ZalgoPromise.all,f=o.ZalgoPromise.resolve;e.resolve=f,e.all=a;var l=function(n){return Object.keys(n||{}).filter(function(n){return n&&"_"!==n&&"#"!==n})},p=(0,r.curry)(function(n,e){var t,r;return e.then(function(n){r=!0,t=n}),r?t:n});e.nowOr=p;var s=p(void 0);e.now=s;var y=function n(e,t){var u,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||t===[])throw new Error("bad key ".concat(t));var c={},a=function(n){return(i?function(n,e,t){return t.then(function(t){var o=(0,r.path)([e,"#"],t),u=(0,r.prop)(e,t);return o?n.get(o).then():u})}:function(n,e){return new o.ZalgoPromise(function(t,r){var o=n.known(e);void 0!==o&&t(o),n.fetch(e).then(function(){return n.known(e)}).then(t).catch(r)})})(e,t,i).then(n||r.identity)},f=function(n){return a(l).then(n||r.identity)};return u={get:function(t){return c[t]||(c[t]=n(e,t,u))},then:a,keys:f,souls:f,count:function(n){return f(r.length).then(n||r.identity)}}};e.scope=function(n){var e,t=n.graph,c=void 0===t?{}:t,a=n.gun,l=n.parentScope,s=n.timeout,d=void 0===s?1e4:s,v=n.cache,h=void 0===v?null:v,g=n.getter,m=n.noGun,b=void 0!==m&&m,w=n.isCacheing,P=void 0!==w&&w,S=n.isCached,j=void 0!==S&&S,O=n.onlyCache,x=void 0!==O&&O,q=[],_={},k={},A={...h||{}},C={},E={...c},M=function(n,e){var t=E[n],o=t;return e&&(o=(0,r.mergeDeepRight)(t||{},e)),E[n]=o||E[n]||null,(0,r.equals)(t,o)||q.forEach(function(e){return e(n,o)}),o},Q=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];var u=[n].concat(t).map(function(n){return"object"===i(n)?JSON.stringify(n):"".concat(n)});return[(0,r.path)(u,A),u]},T=function(n,t){for(var o=arguments.length,i=new Array(o>2?o-2:0),c=2;c<o;c++)i[c-2]=arguments[c];if(l)return l.cacheQuery.apply(l,[n,t].concat(i));var a=u(Q.apply(void 0,[n].concat(i)),2),p=a[0],s=a[1];return x?f(p):t.apply(void 0,[e].concat(i)).then(function(n){return A=P?(0,r.assocPath)(s,n,A):(0,r.dissocPath)(s,A),_=(0,r.dissocPath)(r.path,_),n})};return e={on:function(n){return q.push(n)},off:function(n){return q=q.filter(function(e){return e!==n})},get:function(n){return C[n]||(C[n]=y(e,n))},getCache:function(){return A},known:function(n){return l?l.known(n):E[n]},fetch:function(n){return l?l.fetch(n):k[n]=k[n]||new o.ZalgoPromise(function(e){var t;if(!a)return e(null);var r=function(r){clearTimeout(t),e(M(n,r))};if(t=setTimeout(function(){n in E||(console.log("slow query",n),r(null))},d),"string"!=typeof n)throw new Error("bad SOUL ".concat(n));if(g&&g(n).then(r),!b){var o=a.get(n);o.on(r),o.not&&o.not(function(){return r(null)})}})},cacheQuery:T,cachedQuery:function(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];if(l)return l.cachedQuery.apply(l,[n,e].concat(r));var i=u(Q.apply(void 0,[n].concat(r)),1)[0],c=T.apply(void 0,[n,e].concat(r));return j&&i?f(p(i,c)):c},parentScope:l,getGraph:function(){return E},getAccesses:function(){return C},load:M,loadCachedResults:function(n){A=(0,r.mergeDeepRight)(A,n),q.forEach(function(n){return n()})}}};e.query=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=function(t){for(var r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];return t.cachedQuery.apply(t,[e,n].concat(o))},o=e?t:n,u=e?t:n;return u.query=n,u.cached=o,u.now=(0,r.compose)(s,o),u}},function(e,t){e.exports=n},function(n,t){n.exports=e}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tc2NvcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1zY29wZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ3VuLXNjb3BlL2V4dGVybmFsIFwicmFtZGFcIiIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvZXh0ZXJuYWwgXCJ6YWxnby1wcm9taXNlXCIiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9yYW1kYSIsIl96YWxnb1Byb21pc2UiLCJQcm9taXNlIiwiWmFsZ29Qcm9taXNlIiwiYWxsIiwicmVzb2x2ZSIsIm5vZGVLZXlzIiwib2JqIiwia2V5cyIsImZpbHRlciIsIm5vd09yIiwiY3VycnkiLCJkZWZhdWx0VmFsdWUiLCJwcm9taXNlIiwicmVzdWx0IiwicmVzb2x2ZWQiLCJ0aGVuIiwicmVzIiwibm93IiwidW5kZWZpbmVkIiwiYWNjZXNzIiwic2NvcGUiLCJ0aGlzYWNjZXNzIiwicGFjY2VzcyIsImFyZ3VtZW50cyIsImxlbmd0aCIsIkVycm9yIiwiY29uY2F0IiwiYWNjZXNzZXMiLCJmbiIsInBhcmVudGFjY2VzcyIsImRhdGEiLCJzb3VsIiwicGF0aCIsInZhbCIsInByb3AiLCJvayIsImZhaWwiLCJrbm93biIsImZldGNoIiwiY2F0Y2giLCJpZGVudGl0eSIsImdLZXkiLCJzb3VscyIsImNvdW50IiwiX3JlZiIsInRoaXNTY29wZSIsIl9yZWYkZ3JhcGgiLCJncmFwaCIsImRlZmF1bHRHcmFwaCIsImd1biIsInBhcmVudFNjb3BlIiwiX3JlZiR0aW1lb3V0IiwidGltZW91dCIsIl9yZWYkY2FjaGUiLCJjYWNoZSIsIl9yZWYkbm9HdW4iLCJub0d1biIsIl9yZWYkaXNDYWNoZWluZyIsImlzQ2FjaGVpbmciLCJfcmVmJGlzQ2FjaGVkIiwiaXNDYWNoZWQiLCJfcmVmJG9ubHlDYWNoZSIsIm9ubHlDYWNoZSIsImxpc3RlbmVycyIsImNhY2hlUHJvbWlzZXMiLCJwcm9taXNlcyIsImNhY2hlZFJlc3VsdHMiLCJsb2FkIiwiZXhpc3RpbmciLCJtZXJnZURlZXBSaWdodCIsImVxdWFscyIsImZvckVhY2giLCJnZXRDYWNoZWQiLCJfbGVuIiwiYXJncyIsIkFycmF5IiwiX2tleSIsIm1hcCIsIngiLCJfdHlwZW9mIiwiSlNPTiIsInN0cmluZ2lmeSIsImNhY2hlUXVlcnkiLCJxdWVyeUZuIiwiX2xlbjIiLCJfa2V5MiIsImFwcGx5IiwiX2dldENhY2hlZDIiLCJfc2xpY2VkVG9BcnJheSIsImNhY2hlZCIsImFzc29jUGF0aCIsImRpc3NvY1BhdGgiLCJvbiIsInB1c2giLCJvZmYiLCJnZXRDYWNoZSIsInJlYWRUaW1lb3V0IiwicmVjZWl2ZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJjb25zb2xlIiwibG9nIiwiY2hhaW4iLCJub3QiLCJjYWNoZWRRdWVyeSIsIl9sZW4zIiwiX2tleTMiLCJnZXRHcmFwaCIsImdldEFjY2Vzc2VzIiwibG9hZENhY2hlZFJlc3VsdHMiLCJuZXdSZXN1bHRzIiwic2NvcGVPYmoiLCJfbGVuNCIsIl9rZXk0IiwiZG9DYWNoZWRRdWVyeSIsInF1ZXJ5IiwiY29tcG9zZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLGtCQUNBLG1CQUFBQyxlQUFBQyxJQUNBRCxPQUFBLHNDQUFBSixHQUNBLGlCQUFBQyxRQUNBQSxRQUFBLGFBQUFELEVBQUFHLFFBQUEsU0FBQUEsUUFBQSxrQkFFQUosRUFBQSxhQUFBQyxFQUFBRCxFQUFBLE1BQUFBLEVBQUEsa0JBUkEsQ0FTQyxvQkFBQU8sVUFBQUMsS0FBQSxTQUFBQyxFQUFBQyxHQUNELG1CQ1RBLElBQUFDLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVgsUUFHQSxJQUFBQyxFQUFBUSxFQUFBRSxHQUFBLENBQ0FDLEVBQUFELEVBQ0FFLEdBQUEsRUFDQWIsUUFBQSxJQVVBLE9BTkFjLEVBQUFILEdBQUFJLEtBQUFkLEVBQUFELFFBQUFDLElBQUFELFFBQUFVLEdBR0FULEVBQUFZLEdBQUEsRUFHQVosRUFBQUQsUUEwREEsT0FyREFVLEVBQUFNLEVBQUFGLEVBR0FKLEVBQUFPLEVBQUFSLEVBR0FDLEVBQUFRLEVBQUEsU0FBQWxCLEVBQUFtQixFQUFBQyxHQUNBVixFQUFBVyxFQUFBckIsRUFBQW1CLElBQ0FHLE9BQUFDLGVBQUF2QixFQUFBbUIsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1YsRUFBQWdCLEVBQUEsU0FBQTFCLEdBQ0Esb0JBQUEyQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBdkIsRUFBQTJCLE9BQUFDLFlBQUEsQ0FBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUF2QixFQUFBLGNBQWlENkIsT0FBQSxLQVFqRG5CLEVBQUFvQixFQUFBLFNBQUFELEVB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RSxFQUFVSSxXQUFWLEdBQVdoSCxFQUFNNkcsR0FBakJ6RCxPQUE2QmdELElBRzdDLE9BQUtkLEdBQ0U2QixFQUFTckYsRUFBUUssRUFBTWdGLEVBQVE3RSxJQURoQkEsR0FxQnRCc0MsY0FDQXlELFNBakJlLGtCQUFNNUQsR0FrQnJCNkQsWUFqQmtCLGtCQUFNakYsR0FrQnhCd0MsT0FDQTBDLGtCQWxCd0IsU0FBQUMsR0FDeEI1QyxHQUFnQixFQUFBbkUsRUFBQXNFLGdCQUFlSCxFQUFlNEMsR0FDOUMvQyxFQUFVUSxRQUFRLFNBQUEzQyxHQUFFLE9BQUlBLGlCQXFCUCxTQUFDdUQsR0FBeUIsSUFBaEI3RyxFQUFnQmlELFVBQUFDLE9BQUEsUUFBQU4sSUFBQUssVUFBQSxHQUFBQSxVQUFBLEdBQVQsS0FDOUJpRixFQUFjLFNBQUNPLEdBQUQsUUFBQUMsRUFBQXpGLFVBQUFDLE9BQWNrRCxFQUFkLElBQUFDLE1BQUFxQyxFQUFBLEVBQUFBLEVBQUEsS0FBQUMsRUFBQSxFQUFBQSxFQUFBRCxFQUFBQyxJQUFjdkMsRUFBZHVDLEVBQUEsR0FBQTFGLFVBQUEwRixHQUFBLE9BQ2xCRixFQUFTUCxZQUFUbEIsTUFBQXlCLEVBQVEsQ0FBYXpJLEVBQU02RyxHQUFuQnpELE9BQStCZ0QsS0FDbkN3QyxFQUFnQjVJLEVBQU9rSSxFQUFjckIsRUFDckN0RSxFQUFTdkMsRUFBT2tJLEVBQWNyQixFQVFwQyxPQU5BdEUsRUFBT3NHLE1BQVFoQyxFQUNmdEUsRUFBTzRFLE9BQVN5QixFQUNoQnJHLEVBQU9JLEtBQU0sRUFBQWxCLEVBQUFxSCxTQUNYbkcsRUFDQWlHLEdBRUtyRyxrQkMvTVR6RCxFQUFBRCxRQUFBTyxpQkNBQU4sRUFBQUQsUUFBQVEiLCJmaWxlIjoiZ3VuLXNjb3BlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwiemFsZ28tcHJvbWlzZVwiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcImd1bi1zY29wZVwiLCBbXCJyYW1kYVwiLCBcInphbGdvLXByb21pc2VcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiZ3VuLXNjb3BlXCJdID0gZmFjdG9yeShyZXF1aXJlKFwicmFtZGFcIiksIHJlcXVpcmUoXCJ6YWxnby1wcm9taXNlXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJndW4tc2NvcGVcIl0gPSBmYWN0b3J5KHJvb3RbXCJyYW1kYVwiXSwgcm9vdFtcInphbGdvLXByb21pc2VcIl0pO1xufSkodHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fLCBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18yX18pIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQge1xuICBjb21wb3NlLFxuICBlcXVhbHMsXG4gIGRpc3NvY1BhdGgsXG4gIGFzc29jUGF0aCxcbiAgY3VycnksXG4gIHBhdGgsXG4gIHByb3AsXG4gIGxlbmd0aCxcbiAgaWRlbnRpdHksXG4gIG1lcmdlRGVlcFJpZ2h0XG59IGZyb20gXCJyYW1kYVwiO1xuaW1wb3J0IHsgWmFsZ29Qcm9taXNlIH0gZnJvbSBcInphbGdvLXByb21pc2VcIjtcbmV4cG9ydCBjb25zdCBQcm9taXNlID0gWmFsZ29Qcm9taXNlO1xuZXhwb3J0IGNvbnN0IHsgYWxsLCByZXNvbHZlIH0gPSBaYWxnb1Byb21pc2U7XG5cbmNvbnN0IG5vZGVLZXlzID0gb2JqID0+XG4gIE9iamVjdC5rZXlzKG9iaiB8fCB7fSkuZmlsdGVyKGtleSA9PiBrZXkgJiYga2V5ICE9PSBcIl9cIiAmJiBrZXkgIT09IFwiI1wiKTtcblxuZXhwb3J0IGNvbnN0IG5vd09yID0gY3VycnkoKGRlZmF1bHRWYWx1ZSwgcHJvbWlzZSkgPT4ge1xuICBsZXQgcmVzdWx0O1xuICBsZXQgcmVzb2x2ZWQ7XG5cbiAgcHJvbWlzZS50aGVuKHJlcyA9PiB7XG4gICAgcmVzb2x2ZWQgPSB0cnVlO1xuICAgIHJlc3VsdCA9IHJlcztcbiAgfSk7XG4gIHJldHVybiByZXNvbHZlZCA/IHJlc3VsdCA6IGRlZmF1bHRWYWx1ZTtcbn0pO1xuXG5leHBvcnQgY29uc3Qgbm93ID0gbm93T3IodW5kZWZpbmVkKTtcblxuY29uc3Qgbm9kZSA9IChzY29wZSwgc291bCkgPT5cbiAgbmV3IFphbGdvUHJvbWlzZSgob2ssIGZhaWwpID0+IHtcbiAgICBjb25zdCBrbm93biA9IHNjb3BlLmtub3duKHNvdWwpO1xuXG4gICAgaWYgKHR5cGVvZiBrbm93biAhPT0gXCJ1bmRlZmluZWRcIikgb2soa25vd24pO1xuICAgIHNjb3BlXG4gICAgICAuZmV0Y2goc291bClcbiAgICAgIC50aGVuKCgpID0+IHNjb3BlLmtub3duKHNvdWwpKVxuICAgICAgLnRoZW4ob2spXG4gICAgICAuY2F0Y2goZmFpbCk7XG4gIH0pO1xuXG5jb25zdCBlZGdlID0gKHNjb3BlLCBrZXksIHBhcmVudGFjY2VzcykgPT5cbiAgcGFyZW50YWNjZXNzLnRoZW4oZGF0YSA9PiB7XG4gICAgY29uc3Qgc291bCA9IHBhdGgoW2tleSwgXCIjXCJdLCBkYXRhKTtcbiAgICBjb25zdCB2YWwgPSBwcm9wKGtleSwgZGF0YSk7XG5cbiAgICByZXR1cm4gc291bCA/IHNjb3BlLmdldChzb3VsKS50aGVuKCkgOiB2YWw7XG4gIH0pO1xuXG5jb25zdCBhY2Nlc3MgPSAoc2NvcGUsIGtleSwgcGFjY2VzcyA9IG51bGwpID0+IHtcbiAgaWYgKCFrZXkgfHwga2V5ID09PSBbXSkgdGhyb3cgbmV3IEVycm9yKGBiYWQga2V5ICR7a2V5fWApO1xuICBsZXQgdGhpc2FjY2VzcztcbiAgY29uc3QgYWNjZXNzZXMgPSB7fTtcbiAgY29uc3QgZ2V0ID0gZ0tleSA9PlxuICAgIGFjY2Vzc2VzW2dLZXldIHx8IChhY2Nlc3Nlc1tnS2V5XSA9IGFjY2VzcyhzY29wZSwgZ0tleSwgdGhpc2FjY2VzcykpO1xuICBjb25zdCB0aGVuID0gZm4gPT5cbiAgICAocGFjY2VzcyA/IGVkZ2UgOiBub2RlKShzY29wZSwga2V5LCBwYWNjZXNzKS50aGVuKGZuIHx8IGlkZW50aXR5KTtcbiAgY29uc3Qga2V5cyA9IGZuID0+IHRoZW4obm9kZUtleXMpLnRoZW4oZm4gfHwgaWRlbnRpdHkpO1xuICBjb25zdCBjb3VudCA9IGZuID0+IGtleXMobGVuZ3RoKS50aGVuKGZuIHx8IGlkZW50aXR5KTtcblxuICB0aGlzYWNjZXNzID0geyBnZXQsIHRoZW4sIGtleXMsIHNvdWxzOiBrZXlzLCBjb3VudCB9O1xuICByZXR1cm4gdGhpc2FjY2Vzcztcbn07XG5cbmV4cG9ydCBjb25zdCBzY29wZSA9ICh7XG4gIGdyYXBoOiBkZWZhdWx0R3JhcGggPSB7fSxcbiAgZ3VuLFxuICBwYXJlbnRTY29wZSxcbiAgdGltZW91dCA9IDEwMDAwLFxuICBjYWNoZSA9IG51bGwsXG4gIGdldHRlcixcbiAgbm9HdW4gPSBmYWxzZSxcbiAgaXNDYWNoZWluZyA9IGZhbHNlLFxuICBpc0NhY2hlZCA9IGZhbHNlLFxuICBvbmx5Q2FjaGUgPSBmYWxzZVxufSkgPT4ge1xuICBsZXQgdGhpc1Njb3BlO1xuICBsZXQgbGlzdGVuZXJzID0gW107XG4gIGxldCBjYWNoZVByb21pc2VzID0ge307XG4gIGxldCBwcm9taXNlcyA9IHt9O1xuICBsZXQgY2FjaGVkUmVzdWx0cyA9IHsgLi4uKGNhY2hlIHx8IHt9KSB9O1xuICBjb25zdCBhY2Nlc3NlcyA9IHt9O1xuICBjb25zdCBncmFwaCA9IHsgLi4uZGVmYXVsdEdyYXBoIH07XG4gIGNvbnN0IGdldCA9IHNvdWwgPT5cbiAgICBhY2Nlc3Nlc1tzb3VsXSB8fCAoYWNjZXNzZXNbc291bF0gPSBhY2Nlc3ModGhpc1Njb3BlLCBzb3VsKSk7XG4gIGNvbnN0IGtub3duID0gc291bCA9PiAocGFyZW50U2NvcGUgPyBwYXJlbnRTY29wZS5rbm93bihzb3VsKSA6IGdyYXBoW3NvdWxdKTtcbiAgY29uc3Qgb24gPSBmbiA9PiBsaXN0ZW5lcnMucHVzaChmbik7XG4gIGNvbnN0IG9mZiA9IGZuID0+IChsaXN0ZW5lcnMgPSBsaXN0ZW5lcnMuZmlsdGVyKHggPT4geCAhPT0gZm4pKTtcblxuICBjb25zdCBsb2FkID0gKHNvdWwsIGRhdGEpID0+IHtcbiAgICBjb25zdCBleGlzdGluZyA9IGdyYXBoW3NvdWxdO1xuICAgIGxldCByZXN1bHQgPSBleGlzdGluZztcblxuICAgIGlmIChkYXRhKSByZXN1bHQgPSBtZXJnZURlZXBSaWdodChleGlzdGluZyB8fCB7fSwgZGF0YSk7XG4gICAgZ3JhcGhbc291bF0gPSByZXN1bHQgfHwgZ3JhcGhbc291bF0gfHwgbnVsbDtcbiAgICBpZiAoIWVxdWFscyhleGlzdGluZywgcmVzdWx0KSkgbGlzdGVuZXJzLmZvckVhY2goZm4gPT4gZm4oc291bCwgcmVzdWx0KSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBjb25zdCBmZXRjaCA9IHNvdWwgPT5cbiAgICBwYXJlbnRTY29wZVxuICAgICAgPyBwYXJlbnRTY29wZS5mZXRjaChzb3VsKVxuICAgICAgOiAocHJvbWlzZXNbc291bF0gPVxuICAgICAgICAgIHByb21pc2VzW3NvdWxdIHx8XG4gICAgICAgICAgbmV3IFphbGdvUHJvbWlzZShvayA9PiB7XG4gICAgICAgICAgICBsZXQgcmVhZFRpbWVvdXQ7XG5cbiAgICAgICAgICAgIGlmICghZ3VuKSByZXR1cm4gb2sobnVsbCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlY2VpdmUgPSBkYXRhID0+IHtcbiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHJlYWRUaW1lb3V0KTtcbiAgICAgICAgICAgICAgb2sobG9hZChzb3VsLCBkYXRhKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZWFkVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoIShzb3VsIGluIGdyYXBoKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic2xvdyBxdWVyeVwiLCBzb3VsKTtcbiAgICAgICAgICAgICAgICByZWNlaXZlKG51bGwpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aW1lb3V0KTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzb3VsICE9PSBcInN0cmluZ1wiKSB0aHJvdyBuZXcgRXJyb3IoYGJhZCBTT1VMICR7c291bH1gKTtcbiAgICAgICAgICAgIGlmIChnZXR0ZXIpIGdldHRlcihzb3VsKS50aGVuKHJlY2VpdmUpO1xuICAgICAgICAgICAgaWYgKCFub0d1bikge1xuICAgICAgICAgICAgICBjb25zdCBjaGFpbiA9IGd1bi5nZXQoc291bCk7XG5cbiAgICAgICAgICAgICAgY2hhaW4ub24ocmVjZWl2ZSk7XG4gICAgICAgICAgICAgIGlmIChjaGFpbi5ub3QpIGNoYWluLm5vdCgoKSA9PiByZWNlaXZlKG51bGwpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgfSkpO1xuXG4gIGNvbnN0IGdldENhY2hlZCA9IChuYW1lLCAuLi5hcmdzKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gW25hbWUsIC4uLmFyZ3NdLm1hcCh4ID0+XG4gICAgICB0eXBlb2YgeCA9PT0gXCJvYmplY3RcIiA/IEpTT04uc3RyaW5naWZ5KHgpIDogYCR7eH1gXG4gICAgKTtcblxuICAgIHJldHVybiBbcGF0aChrZXksIGNhY2hlZFJlc3VsdHMpLCBrZXldO1xuICB9O1xuXG4gIGNvbnN0IGNhY2hlUXVlcnkgPSAobmFtZSwgcXVlcnlGbiwgLi4uYXJncykgPT4ge1xuICAgIGlmIChwYXJlbnRTY29wZSkgcmV0dXJuIHBhcmVudFNjb3BlLmNhY2hlUXVlcnkobmFtZSwgcXVlcnlGbiwgLi4uYXJncyk7XG4gICAgY29uc3QgW2NhY2hlZCwga2V5XSA9IGdldENhY2hlZChuYW1lLCAuLi5hcmdzKTtcblxuICAgIGlmIChvbmx5Q2FjaGUpIHJldHVybiByZXNvbHZlKGNhY2hlZCk7XG4gICAgcmV0dXJuIHF1ZXJ5Rm4odGhpc1Njb3BlLCAuLi5hcmdzKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICBpZiAoaXNDYWNoZWluZykge1xuICAgICAgICBjYWNoZWRSZXN1bHRzID0gYXNzb2NQYXRoKGtleSwgcmVzdWx0LCBjYWNoZWRSZXN1bHRzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhY2hlZFJlc3VsdHMgPSBkaXNzb2NQYXRoKGtleSwgY2FjaGVkUmVzdWx0cyk7XG4gICAgICB9XG4gICAgICBjYWNoZVByb21pc2VzID0gZGlzc29jUGF0aChwYXRoLCBjYWNoZVByb21pc2VzKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgY2FjaGVkUXVlcnkgPSAobmFtZSwgcXVlcnlGbiwgLi4uYXJncykgPT4ge1xuICAgIGlmIChwYXJlbnRTY29wZSkgcmV0dXJuIHBhcmVudFNjb3BlLmNhY2hlZFF1ZXJ5KG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpO1xuICAgIGNvbnN0IFtjYWNoZWRdID0gZ2V0Q2FjaGVkKG5hbWUsIC4uLmFyZ3MpO1xuICAgIGNvbnN0IHByb21pc2UgPSBjYWNoZVF1ZXJ5KG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpO1xuXG4gICAgLy8gaWYgKCFjYWNoZWQgJiYgaXNDYWNoZWQpIGNvbnNvbGUubG9nKFwiY2FjaGUgbWlzc1wiLCBuYW1lLCBhcmdzKTtcbiAgICBpZiAoIWlzQ2FjaGVkKSByZXR1cm4gcHJvbWlzZTtcbiAgICByZXR1cm4gY2FjaGVkID8gcmVzb2x2ZShub3dPcihjYWNoZWQsIHByb21pc2UpKSA6IHByb21pc2U7XG4gIH07XG5cbiAgY29uc3QgZ2V0Q2FjaGUgPSAoKSA9PiBjYWNoZWRSZXN1bHRzO1xuICBjb25zdCBnZXRHcmFwaCA9ICgpID0+IGdyYXBoO1xuICBjb25zdCBnZXRBY2Nlc3NlcyA9ICgpID0+IGFjY2Vzc2VzO1xuICBjb25zdCBsb2FkQ2FjaGVkUmVzdWx0cyA9IG5ld1Jlc3VsdHMgPT4ge1xuICAgIGNhY2hlZFJlc3VsdHMgPSBtZXJnZURlZXBSaWdodChjYWNoZWRSZXN1bHRzLCBuZXdSZXN1bHRzKTtcbiAgICBsaXN0ZW5lcnMuZm9yRWFjaChmbiA9PiBmbigpKTtcbiAgfTtcblxuICB0aGlzU2NvcGUgPSB7XG4gICAgb24sXG4gICAgb2ZmLFxuICAgIGdldCxcbiAgICBnZXRDYWNoZSxcbiAgICBrbm93bixcbiAgICBmZXRjaCxcbiAgICBjYWNoZVF1ZXJ5LFxuICAgIGNhY2hlZFF1ZXJ5LFxuICAgIHBhcmVudFNjb3BlLFxuICAgIGdldEdyYXBoLFxuICAgIGdldEFjY2Vzc2VzLFxuICAgIGxvYWQsXG4gICAgbG9hZENhY2hlZFJlc3VsdHNcbiAgfTtcbiAgcmV0dXJuIHRoaXNTY29wZTtcbn07XG5cbmV4cG9ydCBjb25zdCBxdWVyeSA9IChxdWVyeUZuLCBuYW1lID0gbnVsbCkgPT4ge1xuICBjb25zdCBjYWNoZWRRdWVyeSA9IChzY29wZU9iaiwgLi4uYXJncykgPT5cbiAgICBzY29wZU9iai5jYWNoZWRRdWVyeShuYW1lLCBxdWVyeUZuLCAuLi5hcmdzKTtcbiAgY29uc3QgZG9DYWNoZWRRdWVyeSA9IG5hbWUgPyBjYWNoZWRRdWVyeSA6IHF1ZXJ5Rm47XG4gIGNvbnN0IHJlc3VsdCA9IG5hbWUgPyBjYWNoZWRRdWVyeSA6IHF1ZXJ5Rm47XG5cbiAgcmVzdWx0LnF1ZXJ5ID0gcXVlcnlGbjtcbiAgcmVzdWx0LmNhY2hlZCA9IGRvQ2FjaGVkUXVlcnk7XG4gIHJlc3VsdC5ub3cgPSBjb21wb3NlKFxuICAgIG5vdyxcbiAgICBkb0NhY2hlZFF1ZXJ5XG4gICk7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18xX187IiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18yX187Il0sInNvdXJjZVJvb3QiOiIifQ==
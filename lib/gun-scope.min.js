!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("ramda"),require("zalgo-promise")):"function"==typeof define&&define.amd?define("gun-scope",["ramda","zalgo-promise"],n):"object"==typeof exports?exports["gun-scope"]=n(require("ramda"),require("zalgo-promise")):e["gun-scope"]=n(e.ramda,e["zalgo-promise"])}("undefined"!=typeof self?self:this,function(e,n){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.query=n.scope=n.now=n.nowOr=n.resolve=n.all=n.Promise=void 0;var r=t(1),o=t(2);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=o.ZalgoPromise;n.Promise=i;var c=o.ZalgoPromise.all,f=o.ZalgoPromise.resolve;n.resolve=f,n.all=c;var a=function(e){return Object.keys(e||{}).filter(function(e){return e&&"_"!==e&&"#"!==e})},l=(0,r.curry)(function(e,n){var t,r;return n.then(function(e){r=!0,t=e}),r?t:e});n.nowOr=l;var s=l(void 0);n.now=s;var p=function e(n,t){var u,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||t===[])throw new Error("bad key ".concat(t));var c={},f=function(e){return(i?function(e,n,t){return t.then(function(t){var o=(0,r.path)([n,"#"],t),u=(0,r.prop)(n,t);return o?e.get(o).then():u})}:function(e,n){return new o.ZalgoPromise(function(t,r){var o=e.known(n);void 0!==o&&t(o),e.fetch(n).then(function(){return e.known(n)}).then(t).catch(r)})})(n,t,i).then(e||r.identity)},l=function(e){return f(a).then(e||r.identity)};return u={get:function(t){return c[t]||(c[t]=e(n,t,u))},then:f,keys:l,souls:l,count:function(e){return l(r.length).then(e||r.identity)}}};n.scope=function(e){var n,t=e.graph,i=void 0===t?{}:t,c=e.gun,a=e.parentScope,s=e.timeout,d=void 0===s?1e4:s,y=e.cache,h=void 0===y?null:y,v=e.getter,g=e.noGun,m=void 0!==g&&g,b=e.isCacheing,w=void 0!==b&&b,P=e.isCached,j=void 0!==P&&P,O=e.onlyCache,S=void 0!==O&&O,x=[],_={},q={},k={...h||{}},C={},M={...i},Z=function(e,n){var t=M[e],o=t;return null===n?o=null:n&&(o=t?(0,r.mergeDeepRight)(t||{},n):n),M[e]=o,x.forEach(function(n){return n(e,o)}),o};return n={on:function(e){return x.push(e)},off:function(e){return x=x.filter(function(n){return n!==e})},get:function(e){return C[e]||(C[e]=p(n,e))},getCache:function(){return k},known:function(e){return a?a.known(e):M[e]},fetch:function(e){return a?a.fetch(e):q[e]=q[e]||new o.ZalgoPromise(function(n){var t;if(!c)return n(null);var r=function(r){clearTimeout(t),n(Z(e,r))};if(t=setTimeout(function(){e in M||(console.log("slow query",e),r(null))},d),"string"!=typeof e)throw new Error("bad SOUL ".concat(e));v&&v(e).then(r),m||c.get(e).on(r)})},cachedQuery:function(e,t){for(var o=arguments.length,i=new Array(o>2?o-2:0),c=2;c<o;c++)i[c-2]=arguments[c];if(a)return a.cachedQuery.apply(a,[e,t].concat(i));var s=[e].concat(i).map(function(e){return"object"===u(e)?JSON.stringify(e):"".concat(e)}),p=(0,r.path)(s,k);if(S)return f(p);var d=t.apply(void 0,[n].concat(i)).then(function(e){return(w||j)&&(k=(0,r.assocPath)(s,e,k)),_=(0,r.dissocPath)(r.path,_),e});return p?f(l(p,d)):d},getGraph:function(){return M},getAccesses:function(){return C},load:Z,loadCachedResults:function(e){k=(0,r.mergeDeepRight)(k,e),x.forEach(function(e){return e()})}}};n.query=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=n?function(t){for(var r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];return t.cachedQuery.apply(t,[n,e].concat(o))}:e,o=t;return o.query=e,o.cached=t,o.now=(0,r.compose)(s,t),o}},function(n,t){n.exports=e},function(e,t){e.exports=n}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tc2NvcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1zY29wZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ3VuLXNjb3BlL2V4dGVybmFsIFwicmFtZGFcIiIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvZXh0ZXJuYWwgXCJ6YWxnby1wcm9taXNlXCIiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9yYW1kYSIsIl96YWxnb1Byb21pc2UiLCJQcm9taXNlIiwiWmFsZ29Qcm9taXNlIiwiYWxsIiwicmVzb2x2ZSIsIm5vZGVLZXlzIiwib2JqIiwia2V5cyIsImZpbHRlciIsIm5vd09yIiwiY3VycnkiLCJkZWZhdWx0VmFsdWUiLCJwcm9taXNlIiwicmVzdWx0IiwicmVzb2x2ZWQiLCJ0aGVuIiwicmVzIiwibm93IiwidW5kZWZpbmVkIiwiYWNjZXNzIiwic2NvcGUiLCJ0aGlzYWNjZXNzIiwicGFjY2VzcyIsImFyZ3VtZW50cyIsImxlbmd0aCIsIkVycm9yIiwiY29uY2F0IiwiYWNjZXNzZXMiLCJmbiIsInBhcmVudGFjY2VzcyIsImRhdGEiLCJzb3VsIiwicGF0aCIsInZhbCIsInByb3AiLCJvayIsImZhaWwiLCJrbm93biIsImZldGNoIiwiY2F0Y2giLCJpZGVudGl0eSIsImdLZXkiLCJzb3VscyIsImNvdW50IiwiX3JlZiIsInRoaXNTY29wZSIsIl9yZWYkZ3JhcGgiLCJncmFwaCIsImRlZmF1bHRHcmFwaCIsImd1biIsInBhcmVudFNjb3BlIiwiX3JlZiR0aW1lb3V0IiwidGltZW91dCIsIl9yZWYkY2FjaGUiLCJjYWNoZSIsIl9yZWYkbm9HdW4iLCJub0d1biIsIl9yZWYkaXNDYWNoZWluZyIsImlzQ2FjaGVpbmciLCJfcmVmJGlzQ2FjaGVkIiwiaXNDYWNoZWQiLCJfcmVmJG9ubHlDYWNoZSIsIm9ubHlDYWNoZSIsImxpc3RlbmVycyIsImNhY2hlUHJvbWlzZXMiLCJwcm9taXNlcyIsImNhY2hlZFJlc3VsdHMiLCJsb2FkIiwiZXhpc3RpbmciLCJtZXJnZURlZXBSaWdodCIsImZvckVhY2giLCJvbiIsInB1c2giLCJvZmYiLCJ4IiwiZ2V0Q2FjaGUiLCJyZWFkVGltZW91dCIsInJlY2VpdmUiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiY29uc29sZSIsImxvZyIsImNhY2hlZFF1ZXJ5IiwicXVlcnlGbiIsIl9sZW4iLCJhcmdzIiwiQXJyYXkiLCJfa2V5IiwiYXBwbHkiLCJtYXAiLCJfdHlwZW9mIiwiSlNPTiIsInN0cmluZ2lmeSIsImNhY2hlZCIsImFzc29jUGF0aCIsImRpc3NvY1BhdGgiLCJnZXRHcmFwaCIsImdldEFjY2Vzc2VzIiwibG9hZENhY2hlZFJlc3VsdHMiLCJuZXdSZXN1bHRzIiwiZG9DYWNoZWRRdWVyeSIsInNjb3BlT2JqIiwiX2xlbjIiLCJfa2V5MiIsInF1ZXJ5IiwiY29tcG9zZSJdLCJtYXBwaW5ncyI6IkNBQUEs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LEdBQWNFLEtBQ2hCTSxHQUFnQixFQUFBbkUsRUFBQStGLFdBQVV4RyxFQUFLdUIsRUFBUXFELElBRXpDRixHQUFnQixFQUFBakUsRUFBQWdHLFlBQUFoRyxFQUFBaUMsS0FBaUJnQyxHQUMxQm5ELElBR1QsT0FBT2dGLEVBQVN6RixFQUFRSyxFQUFNb0YsRUFBUWpGLElBQVlBLEdBbUJsRG9GLFNBZmUsa0JBQU1qRCxHQWdCckJrRCxZQWZrQixrQkFBTXRFLEdBZ0J4QndDLE9BQ0ErQixrQkFoQndCLFNBQUFDLEdBQ3hCakMsR0FBZ0IsRUFBQW5FLEVBQUFzRSxnQkFBZUgsRUFBZWlDLEdBQzlDcEMsRUFBVU8sUUFBUSxTQUFBMUMsR0FBRSxPQUFJQSxpQkFtQlAsU0FBQ3VELEdBQXlCLElBQWhCN0csRUFBZ0JpRCxVQUFBQyxPQUFBLFFBQUFOLElBQUFLLFVBQUEsR0FBQUEsVUFBQSxHQUFULEtBRzlCNkUsRUFBZ0I5SCxFQUZGLFNBQUMrSCxHQUFELFFBQUFDLEVBQUEvRSxVQUFBQyxPQUFjNkQsRUFBZCxJQUFBQyxNQUFBZ0IsRUFBQSxFQUFBQSxFQUFBLEtBQUFDLEVBQUEsRUFBQUEsRUFBQUQsRUFBQUMsSUFBY2xCLEVBQWRrQixFQUFBLEdBQUFoRixVQUFBZ0YsR0FBQSxPQUNsQkYsRUFBU25CLFlBQVRNLE1BQUFhLEVBQVEsQ0FBYS9ILEVBQU02RyxHQUFuQnpELE9BQStCMkQsS0FDRUYsRUFDckN0RSxFQUFTdUYsRUFRZixPQU5BdkYsRUFBTzJGLE1BQVFyQixFQUNmdEUsRUFBT2dGLE9BQVNPLEVBQ2hCdkYsRUFBT0ksS0FBTSxFQUFBbEIsRUFBQTBHLFNBQ1h4RixFQUNBbUYsR0FFS3ZGLGtCQzVMVHpELEVBQUFELFFBQUFPLGlCQ0FBTixFQUFBRCxRQUFBUSIsImZpbGUiOiJndW4tc2NvcGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwicmFtZGFcIiksIHJlcXVpcmUoXCJ6YWxnby1wcm9taXNlXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiZ3VuLXNjb3BlXCIsIFtcInJhbWRhXCIsIFwiemFsZ28tcHJvbWlzZVwiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJndW4tc2NvcGVcIl0gPSBmYWN0b3J5KHJlcXVpcmUoXCJyYW1kYVwiKSwgcmVxdWlyZShcInphbGdvLXByb21pc2VcIikpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImd1bi1zY29wZVwiXSA9IGZhY3Rvcnkocm9vdFtcInJhbWRhXCJdLCByb290W1wiemFsZ28tcHJvbWlzZVwiXSk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0aGlzLCBmdW5jdGlvbihfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18xX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzJfXykge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7XG4gIGNvbXBvc2UsXG4gIGRpc3NvY1BhdGgsXG4gIGFzc29jUGF0aCxcbiAgY3VycnksXG4gIHBhdGgsXG4gIHByb3AsXG4gIGxlbmd0aCxcbiAgaWRlbnRpdHksXG4gIG1lcmdlRGVlcFJpZ2h0XG59IGZyb20gXCJyYW1kYVwiO1xuaW1wb3J0IHsgWmFsZ29Qcm9taXNlIH0gZnJvbSBcInphbGdvLXByb21pc2VcIjtcbmV4cG9ydCBjb25zdCBQcm9taXNlID0gWmFsZ29Qcm9taXNlO1xuZXhwb3J0IGNvbnN0IHsgYWxsLCByZXNvbHZlIH0gPSBaYWxnb1Byb21pc2U7XG5cbmNvbnN0IG5vZGVLZXlzID0gb2JqID0+XG4gIE9iamVjdC5rZXlzKG9iaiB8fCB7fSkuZmlsdGVyKGtleSA9PiBrZXkgJiYga2V5ICE9PSBcIl9cIiAmJiBrZXkgIT09IFwiI1wiKTtcblxuZXhwb3J0IGNvbnN0IG5vd09yID0gY3VycnkoKGRlZmF1bHRWYWx1ZSwgcHJvbWlzZSkgPT4ge1xuICBsZXQgcmVzdWx0O1xuICBsZXQgcmVzb2x2ZWQ7XG5cbiAgcHJvbWlzZS50aGVuKHJlcyA9PiB7XG4gICAgcmVzb2x2ZWQgPSB0cnVlO1xuICAgIHJlc3VsdCA9IHJlcztcbiAgfSk7XG4gIHJldHVybiByZXNvbHZlZCA/IHJlc3VsdCA6IGRlZmF1bHRWYWx1ZTtcbn0pO1xuXG5leHBvcnQgY29uc3Qgbm93ID0gbm93T3IodW5kZWZpbmVkKTtcblxuY29uc3Qgbm9kZSA9IChzY29wZSwgc291bCkgPT5cbiAgbmV3IFphbGdvUHJvbWlzZSgob2ssIGZhaWwpID0+IHtcbiAgICBjb25zdCBrbm93biA9IHNjb3BlLmtub3duKHNvdWwpO1xuXG4gICAgaWYgKHR5cGVvZiBrbm93biAhPT0gXCJ1bmRlZmluZWRcIikgb2soa25vd24pO1xuICAgIHNjb3BlXG4gICAgICAuZmV0Y2goc291bClcbiAgICAgIC50aGVuKCgpID0+IHNjb3BlLmtub3duKHNvdWwpKVxuICAgICAgLnRoZW4ob2spXG4gICAgICAuY2F0Y2goZmFpbCk7XG4gIH0pO1xuXG5jb25zdCBlZGdlID0gKHNjb3BlLCBrZXksIHBhcmVudGFjY2VzcykgPT5cbiAgcGFyZW50YWNjZXNzLnRoZW4oZGF0YSA9PiB7XG4gICAgY29uc3Qgc291bCA9IHBhdGgoW2tleSwgXCIjXCJdLCBkYXRhKTtcbiAgICBjb25zdCB2YWwgPSBwcm9wKGtleSwgZGF0YSk7XG5cbiAgICByZXR1cm4gc291bCA/IHNjb3BlLmdldChzb3VsKS50aGVuKCkgOiB2YWw7XG4gIH0pO1xuXG5jb25zdCBhY2Nlc3MgPSAoc2NvcGUsIGtleSwgcGFjY2VzcyA9IG51bGwpID0+IHtcbiAgaWYgKCFrZXkgfHwga2V5ID09PSBbXSkgdGhyb3cgbmV3IEVycm9yKGBiYWQga2V5ICR7a2V5fWApO1xuICBsZXQgdGhpc2FjY2VzcztcbiAgY29uc3QgYWNjZXNzZXMgPSB7fTtcbiAgY29uc3QgZ2V0ID0gZ0tleSA9PlxuICAgIGFjY2Vzc2VzW2dLZXldIHx8IChhY2Nlc3Nlc1tnS2V5XSA9IGFjY2VzcyhzY29wZSwgZ0tleSwgdGhpc2FjY2VzcykpO1xuICBjb25zdCB0aGVuID0gZm4gPT5cbiAgICAocGFjY2VzcyA/IGVkZ2UgOiBub2RlKShzY29wZSwga2V5LCBwYWNjZXNzKS50aGVuKGZuIHx8IGlkZW50aXR5KTtcbiAgY29uc3Qga2V5cyA9IGZuID0+IHRoZW4obm9kZUtleXMpLnRoZW4oZm4gfHwgaWRlbnRpdHkpO1xuICBjb25zdCBjb3VudCA9IGZuID0+IGtleXMobGVuZ3RoKS50aGVuKGZuIHx8IGlkZW50aXR5KTtcblxuICB0aGlzYWNjZXNzID0geyBnZXQsIHRoZW4sIGtleXMsIHNvdWxzOiBrZXlzLCBjb3VudCB9O1xuICByZXR1cm4gdGhpc2FjY2Vzcztcbn07XG5cbmV4cG9ydCBjb25zdCBzY29wZSA9ICh7XG4gIGdyYXBoOiBkZWZhdWx0R3JhcGggPSB7fSxcbiAgZ3VuLFxuICBwYXJlbnRTY29wZSxcbiAgdGltZW91dCA9IDEwMDAwLFxuICBjYWNoZSA9IG51bGwsXG4gIGdldHRlcixcbiAgbm9HdW4gPSBmYWxzZSxcbiAgaXNDYWNoZWluZyA9IGZhbHNlLFxuICBpc0NhY2hlZCA9IGZhbHNlLFxuICBvbmx5Q2FjaGUgPSBmYWxzZVxufSkgPT4ge1xuICBsZXQgdGhpc1Njb3BlO1xuICBsZXQgbGlzdGVuZXJzID0gW107XG4gIGxldCBjYWNoZVByb21pc2VzID0ge307XG4gIGxldCBwcm9taXNlcyA9IHt9O1xuICBsZXQgY2FjaGVkUmVzdWx0cyA9IHsgLi4uKGNhY2hlIHx8IHt9KSB9O1xuICBjb25zdCBhY2Nlc3NlcyA9IHt9O1xuICBjb25zdCBncmFwaCA9IHsgLi4uZGVmYXVsdEdyYXBoIH07XG4gIGNvbnN0IGdldCA9IHNvdWwgPT5cbiAgICBhY2Nlc3Nlc1tzb3VsXSB8fCAoYWNjZXNzZXNbc291bF0gPSBhY2Nlc3ModGhpc1Njb3BlLCBzb3VsKSk7XG4gIGNvbnN0IGtub3duID0gc291bCA9PiAocGFyZW50U2NvcGUgPyBwYXJlbnRTY29wZS5rbm93bihzb3VsKSA6IGdyYXBoW3NvdWxdKTtcbiAgY29uc3Qgb24gPSBmbiA9PiBsaXN0ZW5lcnMucHVzaChmbik7XG4gIGNvbnN0IG9mZiA9IGZuID0+IChsaXN0ZW5lcnMgPSBsaXN0ZW5lcnMuZmlsdGVyKHggPT4geCAhPT0gZm4pKTtcblxuICBjb25zdCBsb2FkID0gKHNvdWwsIGRhdGEpID0+IHtcbiAgICBjb25zdCBleGlzdGluZyA9IGdyYXBoW3NvdWxdO1xuICAgIGxldCByZXN1bHQgPSBleGlzdGluZztcblxuICAgIGlmIChkYXRhID09PSBudWxsKSB7XG4gICAgICByZXN1bHQgPSBudWxsO1xuICAgIH0gZWxzZSBpZiAoZGF0YSkge1xuICAgICAgcmVzdWx0ID0gZXhpc3RpbmcgPyBtZXJnZURlZXBSaWdodChleGlzdGluZyB8fCB7fSwgZGF0YSkgOiBkYXRhO1xuICAgIH1cbiAgICBncmFwaFtzb3VsXSA9IHJlc3VsdDtcbiAgICBsaXN0ZW5lcnMuZm9yRWFjaChmbiA9PiBmbihzb3VsLCByZXN1bHQpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGNvbnN0IGZldGNoID0gc291bCA9PlxuICAgIHBhcmVudFNjb3BlXG4gICAgICA/IHBhcmVudFNjb3BlLmZldGNoKHNvdWwpXG4gICAgICA6IChwcm9taXNlc1tzb3VsXSA9XG4gICAgICAgICAgcHJvbWlzZXNbc291bF0gfHxcbiAgICAgICAgICBuZXcgWmFsZ29Qcm9taXNlKG9rID0+IHtcbiAgICAgICAgICAgIGxldCByZWFkVGltZW91dDtcblxuICAgICAgICAgICAgaWYgKCFndW4pIHJldHVybiBvayhudWxsKTtcblxuICAgICAgICAgICAgY29uc3QgcmVjZWl2ZSA9IGRhdGEgPT4ge1xuICAgICAgICAgICAgICBjbGVhclRpbWVvdXQocmVhZFRpbWVvdXQpO1xuICAgICAgICAgICAgICBvayhsb2FkKHNvdWwsIGRhdGEpKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlYWRUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIGlmICghKHNvdWwgaW4gZ3JhcGgpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzbG93IHF1ZXJ5XCIsIHNvdWwpO1xuICAgICAgICAgICAgICAgIHJlY2VpdmUobnVsbCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNvdWwgIT09IFwic3RyaW5nXCIpIHRocm93IG5ldyBFcnJvcihgYmFkIFNPVUwgJHtzb3VsfWApO1xuICAgICAgICAgICAgaWYgKGdldHRlcikgZ2V0dGVyKHNvdWwpLnRoZW4ocmVjZWl2ZSk7XG4gICAgICAgICAgICBpZiAoIW5vR3VuKSBndW4uZ2V0KHNvdWwpLm9uKHJlY2VpdmUpO1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICB9KSk7XG5cbiAgY29uc3QgY2FjaGVkUXVlcnkgPSAobmFtZSwgcXVlcnlGbiwgLi4uYXJncykgPT4ge1xuICAgIGlmIChwYXJlbnRTY29wZSkgcmV0dXJuIHBhcmVudFNjb3BlLmNhY2hlZFF1ZXJ5KG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpO1xuICAgIGNvbnN0IGtleSA9IFtuYW1lLCAuLi5hcmdzXS5tYXAoeCA9PlxuICAgICAgdHlwZW9mIHggPT09IFwib2JqZWN0XCIgPyBKU09OLnN0cmluZ2lmeSh4KSA6IGAke3h9YFxuICAgICk7XG4gICAgY29uc3QgY2FjaGVkID0gcGF0aChrZXksIGNhY2hlZFJlc3VsdHMpO1xuXG4gICAgaWYgKG9ubHlDYWNoZSkgcmV0dXJuIHJlc29sdmUoY2FjaGVkKTtcbiAgICBjb25zdCBwcm9taXNlID0gcXVlcnlGbih0aGlzU2NvcGUsIC4uLmFyZ3MpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgIGlmIChpc0NhY2hlaW5nIHx8IGlzQ2FjaGVkKSB7XG4gICAgICAgIGNhY2hlZFJlc3VsdHMgPSBhc3NvY1BhdGgoa2V5LCByZXN1bHQsIGNhY2hlZFJlc3VsdHMpO1xuICAgICAgfVxuICAgICAgY2FjaGVQcm9taXNlcyA9IGRpc3NvY1BhdGgocGF0aCwgY2FjaGVQcm9taXNlcyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNhY2hlZCA/IHJlc29sdmUobm93T3IoY2FjaGVkLCBwcm9taXNlKSkgOiBwcm9taXNlO1xuICB9O1xuXG4gIGNvbnN0IGdldENhY2hlID0gKCkgPT4gY2FjaGVkUmVzdWx0cztcbiAgY29uc3QgZ2V0R3JhcGggPSAoKSA9PiBncmFwaDtcbiAgY29uc3QgZ2V0QWNjZXNzZXMgPSAoKSA9PiBhY2Nlc3NlcztcbiAgY29uc3QgbG9hZENhY2hlZFJlc3VsdHMgPSBuZXdSZXN1bHRzID0+IHtcbiAgICBjYWNoZWRSZXN1bHRzID0gbWVyZ2VEZWVwUmlnaHQoY2FjaGVkUmVzdWx0cywgbmV3UmVzdWx0cyk7XG4gICAgbGlzdGVuZXJzLmZvckVhY2goZm4gPT4gZm4oKSk7XG4gIH07XG5cbiAgdGhpc1Njb3BlID0ge1xuICAgIG9uLFxuICAgIG9mZixcbiAgICBnZXQsXG4gICAgZ2V0Q2FjaGUsXG4gICAga25vd24sXG4gICAgZmV0Y2gsXG4gICAgY2FjaGVkUXVlcnksXG4gICAgZ2V0R3JhcGgsXG4gICAgZ2V0QWNjZXNzZXMsXG4gICAgbG9hZCxcbiAgICBsb2FkQ2FjaGVkUmVzdWx0c1xuICB9O1xuICByZXR1cm4gdGhpc1Njb3BlO1xufTtcblxuZXhwb3J0IGNvbnN0IHF1ZXJ5ID0gKHF1ZXJ5Rm4sIG5hbWUgPSBudWxsKSA9PiB7XG4gIGNvbnN0IGNhY2hlZFF1ZXJ5ID0gKHNjb3BlT2JqLCAuLi5hcmdzKSA9PlxuICAgIHNjb3BlT2JqLmNhY2hlZFF1ZXJ5KG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpO1xuICBjb25zdCBkb0NhY2hlZFF1ZXJ5ID0gbmFtZSA/IGNhY2hlZFF1ZXJ5IDogcXVlcnlGbjtcbiAgY29uc3QgcmVzdWx0ID0gZG9DYWNoZWRRdWVyeTtcblxuICByZXN1bHQucXVlcnkgPSBxdWVyeUZuO1xuICByZXN1bHQuY2FjaGVkID0gZG9DYWNoZWRRdWVyeTtcbiAgcmVzdWx0Lm5vdyA9IGNvbXBvc2UoXG4gICAgbm93LFxuICAgIGRvQ2FjaGVkUXVlcnlcbiAgKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzFfXzsiLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzJfXzsiXSwic291cmNlUm9vdCI6IiJ9
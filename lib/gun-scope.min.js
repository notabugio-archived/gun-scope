!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("ramda"),require("zalgo-promise")):"function"==typeof define&&define.amd?define("gun-scope",["ramda","zalgo-promise"],e):"object"==typeof exports?exports["gun-scope"]=e(require("ramda"),require("zalgo-promise")):n["gun-scope"]=e(n.ramda,n["zalgo-promise"])}("undefined"!=typeof self?self:this,function(n,e){return function(n){var e={};function r(t){if(e[t])return e[t].exports;var o=e[t]={i:t,l:!1,exports:{}};return n[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=n,r.c=e,r.d=function(n,e,t){r.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,e){if(1&e&&(n=r(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)r.d(t,o,function(e){return n[e]}.bind(null,o));return t},r.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(e,"a",e),e},r.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},r.p="",r(r.s=0)}([function(n,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.query=e.scope=e.now=e.nowOr=e.resolve=e.all=e.Promise=void 0;var t=r(1),o=r(2);function u(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var r=[],t=!0,o=!1,u=void 0;try{for(var c,i=n[Symbol.iterator]();!(t=(c=i.next()).done)&&(r.push(c.value),!e||r.length!==e);t=!0);}catch(n){o=!0,u=n}finally{try{t||null==i.return||i.return()}finally{if(o)throw u}}return r}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(n){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}var i=o.ZalgoPromise;e.Promise=i;var a=o.ZalgoPromise.all,f=o.ZalgoPromise.resolve;e.resolve=f,e.all=a;var l=function(n){return Object.keys(n||{}).filter(function(n){return n&&"_"!==n&&"#"!==n})},p=(0,t.curry)(function(n,e){var r,t;return e.then(function(n){t=!0,r=n}),t?r:n});e.nowOr=p;var y=p(void 0);e.now=y;var s=function n(e,r){var u,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r||r===[])throw new Error("bad key ".concat(r));var i={},a=function(n){return(c?function(n,e,r){return r.then(function(r){var o=(0,t.path)([e,"#"],r),u=(0,t.prop)(e,r);return o?n.get(o).then():u})}:function(n,e){return new o.ZalgoPromise(function(r,t){var o=n.known(e);void 0!==o&&r(o),n.fetch(e).then(function(){return n.known(e)}).then(r).catch(t)})})(e,r,c).then(n||t.identity)},f=function(n){return a(l).then(n||t.identity)};return u={get:function(r){return i[r]||(i[r]=n(e,r,u))},then:a,keys:f,souls:f,count:function(n){return f(t.length).then(n||t.identity)}}};e.scope=function(n){var e,r=n.graph,i=void 0===r?{}:r,a=n.gun,l=n.parentScope,y=n.timeout,d=void 0===y?1e4:y,h=n.cache,v=void 0===h?null:h,g=n.getter,m=n.noGun,b=void 0!==m&&m,w=n.isCacheing,P=void 0!==w&&w,S=n.isCached,j=void 0!==S&&S,O=n.onlyCache,x=void 0!==O&&O,_=[],q={},A={},k={...v||{}},Q={},C={...i},E=function(n,e){var r=C[n],o=r;return e&&(o=r?(0,t.mergeDeepRight)(r||{},e):e),C[n]=o||C[n]||null,_.forEach(function(e){return e(n,o)}),o},M=function(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];var u=[n].concat(r).map(function(n){return"object"===c(n)?JSON.stringify(n):"".concat(n)});return[(0,t.path)(u,k),u]},T=function(n,r){for(var o=arguments.length,c=new Array(o>2?o-2:0),i=2;i<o;i++)c[i-2]=arguments[i];if(l)return l.cacheQuery.apply(l,[n,r].concat(c));var a=u(M.apply(void 0,[n].concat(c)),2),p=a[0],y=a[1];return x?f(p):r.apply(void 0,[e].concat(c)).then(function(n){return P&&(k=(0,t.assocPath)(y,n,k)),q=(0,t.dissocPath)(t.path,q),n})};return e={on:function(n){return _.push(n)},off:function(n){return _=_.filter(function(e){return e!==n})},get:function(n){return Q[n]||(Q[n]=s(e,n))},getCache:function(){return k},known:function(n){return l?l.known(n):C[n]},fetch:function(n){return l?l.fetch(n):A[n]=A[n]||new o.ZalgoPromise(function(e){var r;if(!a)return e(null);var t=function(t){clearTimeout(r),e(E(n,t))};if(r=setTimeout(function(){n in C||(console.log("slow query",n),t(null))},d),"string"!=typeof n)throw new Error("bad SOUL ".concat(n));g&&g(n).then(t),b||a.get(n).on(t)})},cacheQuery:T,cachedQuery:function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),o=2;o<r;o++)t[o-2]=arguments[o];if(l)return l.cachedQuery.apply(l,[n,e].concat(t));var c=u(M.apply(void 0,[n].concat(t)),1)[0],i=T.apply(void 0,[n,e].concat(t));return j&&c?f(p(c,i)):i},parentScope:l,getGraph:function(){return C},getAccesses:function(){return Q},load:E,loadCachedResults:function(n){k=(0,t.mergeDeepRight)(k,n),_.forEach(function(n){return n()})}}};e.query=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=e?function(r){for(var t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];return r.cachedQuery.apply(r,[e,n].concat(o))}:n,o=e?function(r){for(var t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];return r.cacheQuery.apply(r,[e,n].concat(o))}:n;return o.query=n,o.cached=r,o.now=(0,t.compose)(y,r),o}},function(e,r){e.exports=n},function(n,r){n.exports=e}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tc2NvcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1zY29wZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ3VuLXNjb3BlL2V4dGVybmFsIFwicmFtZGFcIiIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvZXh0ZXJuYWwgXCJ6YWxnby1wcm9taXNlXCIiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9yYW1kYSIsIl96YWxnb1Byb21pc2UiLCJQcm9taXNlIiwiWmFsZ29Qcm9taXNlIiwiYWxsIiwicmVzb2x2ZSIsIm5vZGVLZXlzIiwib2JqIiwia2V5cyIsImZpbHRlciIsIm5vd09yIiwiY3VycnkiLCJkZWZhdWx0VmFsdWUiLCJwcm9taXNlIiwicmVzdWx0IiwicmVzb2x2ZWQiLCJ0aGVuIiwicmVzIiwibm93IiwidW5kZWZpbmVkIiwiYWNjZXNzIiwic2NvcGUiLCJ0aGlzYWNjZXNzIiwicGFjY2VzcyIsImFyZ3VtZW50cyIsImxlbmd0aCIsIkVycm9yIiwiY29uY2F0IiwiYWNjZXNzZXMiLCJmbiIsInBhcmVudGFjY2VzcyIsImRhdGEiLCJzb3VsIiwicGF0aCIsInZhbCIsInByb3AiLCJvayIsImZhaWwiLCJrbm93biIsImZldGNoIiwiY2F0Y2giLCJpZGVudGl0eSIsImdLZXkiLCJzb3VscyIsImNvdW50IiwiX3JlZiIsInRoaXNTY29wZSIsIl9yZWYkZ3JhcGgiLCJncmFwaCIsImRlZmF1bHRHcmFwaCIsImd1biIsInBhcmVudFNjb3BlIiwiX3JlZiR0aW1lb3V0IiwidGltZW91dCIsIl9yZWYkY2FjaGUiLCJjYWNoZSIsIl9yZWYkbm9HdW4iLCJub0d1biIsIl9yZWYkaXNDYWNoZWluZyIsImlzQ2FjaGVpbmciLCJfcmVmJGlzQ2FjaGVkIiwiaXNDYWNoZWQiLCJfcmVmJG9ubHlDYWNoZSIsIm9ubHlDYWNoZSIsImxpc3RlbmVycyIsImNhY2hlUHJvbWlzZXMiLCJwcm9taXNlcyIsImNhY2hlZFJlc3VsdHMiLCJsb2FkIiwiZXhpc3RpbmciLCJtZXJnZURlZXBSaWdodCIsImZvckVhY2giLCJnZXRDYWNoZWQiLCJfbGVuIiwiYXJncyIsIkFycmF5IiwiX2tleSIsIm1hcCIsIngiLCJfdHlwZW9mIiwiSlNPTiIsInN0cmluZ2lmeSIsImNhY2hlUXVlcnkiLCJxdWVyeUZuIiwiX2xlbjIiLCJfa2V5MiIsImFwcGx5IiwiX2dldENhY2hlZDIiLCJfc2xpY2VkVG9BcnJheSIsImNhY2hlZCIsImFzc29jUGF0aCIsImRpc3NvY1BhdGgiLCJvbiIsInB1c2giLCJvZmYiLCJnZXRDYWNoZSIsInJlYWRUaW1lb3V0IiwicmVjZWl2ZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJjb25zb2xlIiwibG9nIiwiY2FjaGVkUXVlcnkiLCJfbGVuMyIsIl9rZXkzIiwiZ2V0R3JhcGgiLCJnZXRBY2Nlc3NlcyIsImxvYWRDYWNoZWRSZXN1bHRzIiwibmV3UmVzdWx0cyIsImRvQ2FjaGVkUXVlcnkiLCJzY29wZU9iaiIsIl9sZW41IiwiX2tleTUiLCJfbGVuNCIsIl9rZXk0IiwicXVlcnkiLCJjb21wb3NlIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBLGlCQUFBQyxTQUFBLGlCQUFBQyxPQUNBQSxPQUFBRCxRQUFBRCxFQUFBRyxRQUFBLFNBQUFBLFFBQUEsa0JBQ0EsbUJBQUFDLGVBQUFDLElBQ0FELE9BQUEsc0NBQUFKLEdBQ0EsaUJBQUFDLFFBQ0FBLFFBQUEsYUFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLGtCQUVBSixFQUFBLGFBQUFDLEVBQUFELEVBQUEsTUFBQUEsRUFBQSxrQkFSQSxDQVNDLG9CQUFBTyxVQUFBQyxLQUFBLFNBQUFDLEVBQUFDLEdBQ0QsbUJDVEEsSUFBQUMsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBWCxRQUdBLElBQUFDLEVBQUFRLEVBQUFFLEdBQUEsQ0FDQUMsRUFBQUQsRUFDQUUsR0FBQSxFQUNBYixRQUFBLElBVUEsT0FOQWMsRUFBQUgsR0FBQUksS0FBQWQsRUFBQUQsUUFBQUMsSUFBQUQsUUFBQVUsR0FHQVQsRUFBQVksR0FBQSxFQUdBWixFQUFBRCxRQTBEQSxPQXJEQVUsRUFBQU0sRUFBQUYsRUFHQUosRUFBQU8sRUFBQVIsRUFHQUMsRUFBQVEsRUFBQSxTQUFBbEIsRUFBQW1CLEVBQUFDLEdBQ0FWLEVBQUFXLEVBQUFyQixFQUFBbUIsSUFDQUcsT0FBQUMsZUFBQXZCLEVBQUFtQixFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDVixFQUFBZ0IsRUFBQSxTQUFBMUIsR0FDQSxvQkFBQTJCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUF2QixFQUFBMkIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQXZCLEVBQUEsY0FBaUQ2QixPQUFBLEtBUWpEbkIsRUFBQW9CLEVBQUEsU0FBQUQsRUFBQUUsR0FF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QnJCMEQsWUFqQmtCLGtCQUFNOUUsR0FrQnhCd0MsT0FDQXVDLGtCQWxCd0IsU0FBQUMsR0FDeEJ6QyxHQUFnQixFQUFBbkUsRUFBQXNFLGdCQUFlSCxFQUFleUMsR0FDOUM1QyxFQUFVTyxRQUFRLFNBQUExQyxHQUFFLE9BQUlBLGlCQXFCUCxTQUFDc0QsR0FBeUIsSUFBaEI1RyxFQUFnQmlELFVBQUFDLE9BQUEsUUFBQU4sSUFBQUssVUFBQSxHQUFBQSxVQUFBLEdBQVQsS0FLOUJxRixFQUFnQnRJLEVBRkYsU0FBQ3VJLEdBQUQsUUFBQUMsRUFBQXZGLFVBQUFDLE9BQWNpRCxFQUFkLElBQUFDLE1BQUFvQyxFQUFBLEVBQUFBLEVBQUEsS0FBQUMsRUFBQSxFQUFBQSxFQUFBRCxFQUFBQyxJQUFjdEMsRUFBZHNDLEVBQUEsR0FBQXhGLFVBQUF3RixHQUFBLE9BQ2xCRixFQUFTUixZQUFUaEIsTUFBQXdCLEVBQVEsQ0FBYXZJLEVBQU00RyxHQUFuQnhELE9BQStCK0MsS0FDRVMsRUFDckNyRSxFQUFTdkMsRUFMSSxTQUFDdUksR0FBRCxRQUFBRyxFQUFBekYsVUFBQUMsT0FBY2lELEVBQWQsSUFBQUMsTUFBQXNDLEVBQUEsRUFBQUEsRUFBQSxLQUFBQyxFQUFBLEVBQUFBLEVBQUFELEVBQUFDLElBQWN4QyxFQUFkd0MsRUFBQSxHQUFBMUYsVUFBQTBGLEdBQUEsT0FDakJKLEVBQVM1QixXQUFUSSxNQUFBd0IsRUFBUSxDQUFZdkksRUFBTTRHLEdBQWxCeEQsT0FBOEIrQyxLQUlMUyxFQVFuQyxPQU5BckUsRUFBT3FHLE1BQVFoQyxFQUNmckUsRUFBTzJFLE9BQVNvQixFQUNoQi9GLEVBQU9JLEtBQU0sRUFBQWxCLEVBQUFvSCxTQUNYbEcsRUFDQTJGLEdBRUsvRixrQkN2TVR6RCxFQUFBRCxRQUFBTyxpQkNBQU4sRUFBQUQsUUFBQVEiLCJmaWxlIjoiZ3VuLXNjb3BlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwiemFsZ28tcHJvbWlzZVwiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcImd1bi1zY29wZVwiLCBbXCJyYW1kYVwiLCBcInphbGdvLXByb21pc2VcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiZ3VuLXNjb3BlXCJdID0gZmFjdG9yeShyZXF1aXJlKFwicmFtZGFcIiksIHJlcXVpcmUoXCJ6YWxnby1wcm9taXNlXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJndW4tc2NvcGVcIl0gPSBmYWN0b3J5KHJvb3RbXCJyYW1kYVwiXSwgcm9vdFtcInphbGdvLXByb21pc2VcIl0pO1xufSkodHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fLCBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18yX18pIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQge1xuICBjb21wb3NlLFxuICBkaXNzb2NQYXRoLFxuICBhc3NvY1BhdGgsXG4gIGN1cnJ5LFxuICBwYXRoLFxuICBwcm9wLFxuICBsZW5ndGgsXG4gIGlkZW50aXR5LFxuICBtZXJnZURlZXBSaWdodFxufSBmcm9tIFwicmFtZGFcIjtcbmltcG9ydCB7IFphbGdvUHJvbWlzZSB9IGZyb20gXCJ6YWxnby1wcm9taXNlXCI7XG5leHBvcnQgY29uc3QgUHJvbWlzZSA9IFphbGdvUHJvbWlzZTtcbmV4cG9ydCBjb25zdCB7IGFsbCwgcmVzb2x2ZSB9ID0gWmFsZ29Qcm9taXNlO1xuXG5jb25zdCBub2RlS2V5cyA9IG9iaiA9PlxuICBPYmplY3Qua2V5cyhvYmogfHwge30pLmZpbHRlcihrZXkgPT4ga2V5ICYmIGtleSAhPT0gXCJfXCIgJiYga2V5ICE9PSBcIiNcIik7XG5cbmV4cG9ydCBjb25zdCBub3dPciA9IGN1cnJ5KChkZWZhdWx0VmFsdWUsIHByb21pc2UpID0+IHtcbiAgbGV0IHJlc3VsdDtcbiAgbGV0IHJlc29sdmVkO1xuXG4gIHByb21pc2UudGhlbihyZXMgPT4ge1xuICAgIHJlc29sdmVkID0gdHJ1ZTtcbiAgICByZXN1bHQgPSByZXM7XG4gIH0pO1xuICByZXR1cm4gcmVzb2x2ZWQgPyByZXN1bHQgOiBkZWZhdWx0VmFsdWU7XG59KTtcblxuZXhwb3J0IGNvbnN0IG5vdyA9IG5vd09yKHVuZGVmaW5lZCk7XG5cbmNvbnN0IG5vZGUgPSAoc2NvcGUsIHNvdWwpID0+XG4gIG5ldyBaYWxnb1Byb21pc2UoKG9rLCBmYWlsKSA9PiB7XG4gICAgY29uc3Qga25vd24gPSBzY29wZS5rbm93bihzb3VsKTtcblxuICAgIGlmICh0eXBlb2Yga25vd24gIT09IFwidW5kZWZpbmVkXCIpIG9rKGtub3duKTtcbiAgICBzY29wZVxuICAgICAgLmZldGNoKHNvdWwpXG4gICAgICAudGhlbigoKSA9PiBzY29wZS5rbm93bihzb3VsKSlcbiAgICAgIC50aGVuKG9rKVxuICAgICAgLmNhdGNoKGZhaWwpO1xuICB9KTtcblxuY29uc3QgZWRnZSA9IChzY29wZSwga2V5LCBwYXJlbnRhY2Nlc3MpID0+XG4gIHBhcmVudGFjY2Vzcy50aGVuKGRhdGEgPT4ge1xuICAgIGNvbnN0IHNvdWwgPSBwYXRoKFtrZXksIFwiI1wiXSwgZGF0YSk7XG4gICAgY29uc3QgdmFsID0gcHJvcChrZXksIGRhdGEpO1xuXG4gICAgcmV0dXJuIHNvdWwgPyBzY29wZS5nZXQoc291bCkudGhlbigpIDogdmFsO1xuICB9KTtcblxuY29uc3QgYWNjZXNzID0gKHNjb3BlLCBrZXksIHBhY2Nlc3MgPSBudWxsKSA9PiB7XG4gIGlmICgha2V5IHx8IGtleSA9PT0gW10pIHRocm93IG5ldyBFcnJvcihgYmFkIGtleSAke2tleX1gKTtcbiAgbGV0IHRoaXNhY2Nlc3M7XG4gIGNvbnN0IGFjY2Vzc2VzID0ge307XG4gIGNvbnN0IGdldCA9IGdLZXkgPT5cbiAgICBhY2Nlc3Nlc1tnS2V5XSB8fCAoYWNjZXNzZXNbZ0tleV0gPSBhY2Nlc3Moc2NvcGUsIGdLZXksIHRoaXNhY2Nlc3MpKTtcbiAgY29uc3QgdGhlbiA9IGZuID0+XG4gICAgKHBhY2Nlc3MgPyBlZGdlIDogbm9kZSkoc2NvcGUsIGtleSwgcGFjY2VzcykudGhlbihmbiB8fCBpZGVudGl0eSk7XG4gIGNvbnN0IGtleXMgPSBmbiA9PiB0aGVuKG5vZGVLZXlzKS50aGVuKGZuIHx8IGlkZW50aXR5KTtcbiAgY29uc3QgY291bnQgPSBmbiA9PiBrZXlzKGxlbmd0aCkudGhlbihmbiB8fCBpZGVudGl0eSk7XG5cbiAgdGhpc2FjY2VzcyA9IHsgZ2V0LCB0aGVuLCBrZXlzLCBzb3Vsczoga2V5cywgY291bnQgfTtcbiAgcmV0dXJuIHRoaXNhY2Nlc3M7XG59O1xuXG5leHBvcnQgY29uc3Qgc2NvcGUgPSAoe1xuICBncmFwaDogZGVmYXVsdEdyYXBoID0ge30sXG4gIGd1bixcbiAgcGFyZW50U2NvcGUsXG4gIHRpbWVvdXQgPSAxMDAwMCxcbiAgY2FjaGUgPSBudWxsLFxuICBnZXR0ZXIsXG4gIG5vR3VuID0gZmFsc2UsXG4gIGlzQ2FjaGVpbmcgPSBmYWxzZSxcbiAgaXNDYWNoZWQgPSBmYWxzZSxcbiAgb25seUNhY2hlID0gZmFsc2Vcbn0pID0+IHtcbiAgbGV0IHRoaXNTY29wZTtcbiAgbGV0IGxpc3RlbmVycyA9IFtdO1xuICBsZXQgY2FjaGVQcm9taXNlcyA9IHt9O1xuICBsZXQgcHJvbWlzZXMgPSB7fTtcbiAgbGV0IGNhY2hlZFJlc3VsdHMgPSB7IC4uLihjYWNoZSB8fCB7fSkgfTtcbiAgY29uc3QgYWNjZXNzZXMgPSB7fTtcbiAgY29uc3QgZ3JhcGggPSB7IC4uLmRlZmF1bHRHcmFwaCB9O1xuICBjb25zdCBnZXQgPSBzb3VsID0+XG4gICAgYWNjZXNzZXNbc291bF0gfHwgKGFjY2Vzc2VzW3NvdWxdID0gYWNjZXNzKHRoaXNTY29wZSwgc291bCkpO1xuICBjb25zdCBrbm93biA9IHNvdWwgPT4gKHBhcmVudFNjb3BlID8gcGFyZW50U2NvcGUua25vd24oc291bCkgOiBncmFwaFtzb3VsXSk7XG4gIGNvbnN0IG9uID0gZm4gPT4gbGlzdGVuZXJzLnB1c2goZm4pO1xuICBjb25zdCBvZmYgPSBmbiA9PiAobGlzdGVuZXJzID0gbGlzdGVuZXJzLmZpbHRlcih4ID0+IHggIT09IGZuKSk7XG5cbiAgY29uc3QgbG9hZCA9IChzb3VsLCBkYXRhKSA9PiB7XG4gICAgY29uc3QgZXhpc3RpbmcgPSBncmFwaFtzb3VsXTtcbiAgICBsZXQgcmVzdWx0ID0gZXhpc3Rpbmc7XG5cbiAgICBpZiAoZGF0YSkgcmVzdWx0ID0gZXhpc3RpbmcgPyBtZXJnZURlZXBSaWdodChleGlzdGluZyB8fCB7fSwgZGF0YSkgOiBkYXRhO1xuICAgIGdyYXBoW3NvdWxdID0gcmVzdWx0IHx8IGdyYXBoW3NvdWxdIHx8IG51bGw7XG4gICAgbGlzdGVuZXJzLmZvckVhY2goZm4gPT4gZm4oc291bCwgcmVzdWx0KSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBjb25zdCBmZXRjaCA9IHNvdWwgPT5cbiAgICBwYXJlbnRTY29wZVxuICAgICAgPyBwYXJlbnRTY29wZS5mZXRjaChzb3VsKVxuICAgICAgOiAocHJvbWlzZXNbc291bF0gPVxuICAgICAgICAgIHByb21pc2VzW3NvdWxdIHx8XG4gICAgICAgICAgbmV3IFphbGdvUHJvbWlzZShvayA9PiB7XG4gICAgICAgICAgICBsZXQgcmVhZFRpbWVvdXQ7XG5cbiAgICAgICAgICAgIGlmICghZ3VuKSByZXR1cm4gb2sobnVsbCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlY2VpdmUgPSBkYXRhID0+IHtcbiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHJlYWRUaW1lb3V0KTtcbiAgICAgICAgICAgICAgb2sobG9hZChzb3VsLCBkYXRhKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZWFkVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoIShzb3VsIGluIGdyYXBoKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic2xvdyBxdWVyeVwiLCBzb3VsKTtcbiAgICAgICAgICAgICAgICByZWNlaXZlKG51bGwpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aW1lb3V0KTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzb3VsICE9PSBcInN0cmluZ1wiKSB0aHJvdyBuZXcgRXJyb3IoYGJhZCBTT1VMICR7c291bH1gKTtcbiAgICAgICAgICAgIGlmIChnZXR0ZXIpIGdldHRlcihzb3VsKS50aGVuKHJlY2VpdmUpO1xuICAgICAgICAgICAgaWYgKCFub0d1bikgZ3VuLmdldChzb3VsKS5vbihyZWNlaXZlKTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgfSkpO1xuXG4gIGNvbnN0IGdldENhY2hlZCA9IChuYW1lLCAuLi5hcmdzKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gW25hbWUsIC4uLmFyZ3NdLm1hcCh4ID0+XG4gICAgICB0eXBlb2YgeCA9PT0gXCJvYmplY3RcIiA/IEpTT04uc3RyaW5naWZ5KHgpIDogYCR7eH1gXG4gICAgKTtcblxuICAgIHJldHVybiBbcGF0aChrZXksIGNhY2hlZFJlc3VsdHMpLCBrZXldO1xuICB9O1xuXG4gIGNvbnN0IGNhY2hlUXVlcnkgPSAobmFtZSwgcXVlcnlGbiwgLi4uYXJncykgPT4ge1xuICAgIGlmIChwYXJlbnRTY29wZSkgcmV0dXJuIHBhcmVudFNjb3BlLmNhY2hlUXVlcnkobmFtZSwgcXVlcnlGbiwgLi4uYXJncyk7XG4gICAgY29uc3QgW2NhY2hlZCwga2V5XSA9IGdldENhY2hlZChuYW1lLCAuLi5hcmdzKTtcblxuICAgIGlmIChvbmx5Q2FjaGUpIHJldHVybiByZXNvbHZlKGNhY2hlZCk7XG4gICAgcmV0dXJuIHF1ZXJ5Rm4odGhpc1Njb3BlLCAuLi5hcmdzKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICBpZiAoaXNDYWNoZWluZykgY2FjaGVkUmVzdWx0cyA9IGFzc29jUGF0aChrZXksIHJlc3VsdCwgY2FjaGVkUmVzdWx0cyk7XG4gICAgICBjYWNoZVByb21pc2VzID0gZGlzc29jUGF0aChwYXRoLCBjYWNoZVByb21pc2VzKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgY2FjaGVkUXVlcnkgPSAobmFtZSwgcXVlcnlGbiwgLi4uYXJncykgPT4ge1xuICAgIGlmIChwYXJlbnRTY29wZSkgcmV0dXJuIHBhcmVudFNjb3BlLmNhY2hlZFF1ZXJ5KG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpO1xuICAgIGNvbnN0IFtjYWNoZWRdID0gZ2V0Q2FjaGVkKG5hbWUsIC4uLmFyZ3MpO1xuICAgIGNvbnN0IHByb21pc2UgPSBjYWNoZVF1ZXJ5KG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpO1xuXG4gICAgLy8gaWYgKCFjYWNoZWQgJiYgaXNDYWNoZWQpIGNvbnNvbGUubG9nKFwiY2FjaGUgbWlzc1wiLCBuYW1lLCBhcmdzKTtcbiAgICBpZiAoIWlzQ2FjaGVkKSByZXR1cm4gcHJvbWlzZTtcbiAgICByZXR1cm4gY2FjaGVkID8gcmVzb2x2ZShub3dPcihjYWNoZWQsIHByb21pc2UpKSA6IHByb21pc2U7XG4gIH07XG5cbiAgY29uc3QgZ2V0Q2FjaGUgPSAoKSA9PiBjYWNoZWRSZXN1bHRzO1xuICBjb25zdCBnZXRHcmFwaCA9ICgpID0+IGdyYXBoO1xuICBjb25zdCBnZXRBY2Nlc3NlcyA9ICgpID0+IGFjY2Vzc2VzO1xuICBjb25zdCBsb2FkQ2FjaGVkUmVzdWx0cyA9IG5ld1Jlc3VsdHMgPT4ge1xuICAgIGNhY2hlZFJlc3VsdHMgPSBtZXJnZURlZXBSaWdodChjYWNoZWRSZXN1bHRzLCBuZXdSZXN1bHRzKTtcbiAgICBsaXN0ZW5lcnMuZm9yRWFjaChmbiA9PiBmbigpKTtcbiAgfTtcblxuICB0aGlzU2NvcGUgPSB7XG4gICAgb24sXG4gICAgb2ZmLFxuICAgIGdldCxcbiAgICBnZXRDYWNoZSxcbiAgICBrbm93bixcbiAgICBmZXRjaCxcbiAgICBjYWNoZVF1ZXJ5LFxuICAgIGNhY2hlZFF1ZXJ5LFxuICAgIHBhcmVudFNjb3BlLFxuICAgIGdldEdyYXBoLFxuICAgIGdldEFjY2Vzc2VzLFxuICAgIGxvYWQsXG4gICAgbG9hZENhY2hlZFJlc3VsdHNcbiAgfTtcbiAgcmV0dXJuIHRoaXNTY29wZTtcbn07XG5cbmV4cG9ydCBjb25zdCBxdWVyeSA9IChxdWVyeUZuLCBuYW1lID0gbnVsbCkgPT4ge1xuICBjb25zdCBjYWNoZVF1ZXJ5ID0gKHNjb3BlT2JqLCAuLi5hcmdzKSA9PlxuICAgIHNjb3BlT2JqLmNhY2hlUXVlcnkobmFtZSwgcXVlcnlGbiwgLi4uYXJncyk7XG4gIGNvbnN0IGNhY2hlZFF1ZXJ5ID0gKHNjb3BlT2JqLCAuLi5hcmdzKSA9PlxuICAgIHNjb3BlT2JqLmNhY2hlZFF1ZXJ5KG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpO1xuICBjb25zdCBkb0NhY2hlZFF1ZXJ5ID0gbmFtZSA/IGNhY2hlZFF1ZXJ5IDogcXVlcnlGbjtcbiAgY29uc3QgcmVzdWx0ID0gbmFtZSA/IGNhY2hlUXVlcnkgOiBxdWVyeUZuO1xuXG4gIHJlc3VsdC5xdWVyeSA9IHF1ZXJ5Rm47XG4gIHJlc3VsdC5jYWNoZWQgPSBkb0NhY2hlZFF1ZXJ5O1xuICByZXN1bHQubm93ID0gY29tcG9zZShcbiAgICBub3csXG4gICAgZG9DYWNoZWRRdWVyeVxuICApO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fOyIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fOyJdLCJzb3VyY2VSb290IjoiIn0=
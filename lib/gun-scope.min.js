!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("ramda"),require("zalgo-promise")):"function"==typeof define&&define.amd?define("gun-scope",["ramda","zalgo-promise"],n):"object"==typeof exports?exports["gun-scope"]=n(require("ramda"),require("zalgo-promise")):e["gun-scope"]=n(e.ramda,e["zalgo-promise"])}("undefined"!=typeof self?self:this,function(e,n){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.query=n.scope=n.now=n.nowOr=n.resolve=n.all=n.Promise=void 0;var r=t(1),o=t(2);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=o.ZalgoPromise;n.Promise=i;var c=o.ZalgoPromise.all,f=o.ZalgoPromise.resolve;n.resolve=f,n.all=c;var a=function(e){return Object.keys(e||{}).filter(function(e){return e&&"_"!==e&&"#"!==e})},l=(0,r.curry)(function(e,n){var t,r;return n.then(function(e){r=!0,t=e}),r?t:e});n.nowOr=l;var p=l(void 0);n.now=p;var s=function e(n,t){var u,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||t===[])throw new Error("bad key ".concat(t));var c={},f=function(e){return(i?function(e,n,t){return t.then(function(t){var o=(0,r.path)([n,"#"],t),u=(0,r.prop)(n,t);return o?e.get(o).then():u})}:function(e,n){return new o.ZalgoPromise(function(t,r){var o=e.known(n);void 0!==o&&t(o),e.fetch(n).then(function(){return e.known(n)}).then(t).catch(r)})})(n,t,i).then(e||r.identity)},l=function(e){return f(a).then(e||r.identity)};return u={get:function(t){return c[t]||(c[t]=e(n,t,u))},then:f,keys:l,souls:l,count:function(e){return l(r.length).then(e||r.identity)}}};n.scope=function(e){var n,t=e.graph,i=void 0===t?{}:t,c=e.gun,a=e.parentScope,p=e.timeout,d=void 0===p?1e4:p,y=e.cache,h=void 0===y?null:y,v=e.getter,g=e.noGun,m=void 0!==g&&g,b=e.isCacheing,w=void 0!==b&&b,P=e.isCached,S=void 0!==P&&P,j=e.onlyCache,O=void 0!==j&&j,x=[],_={},q={},k={...h||{}},C={},M={...i},Z=function(e,n){var t=M[e],o=t;return n&&(o=t?(0,r.mergeDeepRight)(t||{},n):n),M[e]=o||M[e]||null,x.forEach(function(n){return n(e,o)}),o};return n={on:function(e){return x.push(e)},off:function(e){return x=x.filter(function(n){return n!==e})},get:function(e){return C[e]||(C[e]=s(n,e))},getCache:function(){return k},known:function(e){return a?a.known(e):M[e]},fetch:function(e){return a?a.fetch(e):q[e]=q[e]||new o.ZalgoPromise(function(n){var t;if(!c)return n(null);var r=function(r){clearTimeout(t),n(Z(e,r))};if(t=setTimeout(function(){e in M||(console.log("slow query",e),r(null))},d),"string"!=typeof e)throw new Error("bad SOUL ".concat(e));v&&v(e).then(r),m||c.get(e).on(r)})},cachedQuery:function(e,t){for(var o=arguments.length,i=new Array(o>2?o-2:0),c=2;c<o;c++)i[c-2]=arguments[c];if(a)return a.cachedQuery.apply(a,[e,t].concat(i));var p=[e].concat(i).map(function(e){return"object"===u(e)?JSON.stringify(e):"".concat(e)}),s=(0,r.path)(p,k);if(O)return f(s);var d=t.apply(void 0,[n].concat(i)).then(function(e){return(w||S)&&(k=(0,r.assocPath)(p,e,k)),_=(0,r.dissocPath)(r.path,_),e});return s?f(l(s,d)):d},parentScope:a,getGraph:function(){return M},getAccesses:function(){return C},load:Z,loadCachedResults:function(e){k=(0,r.mergeDeepRight)(k,e),x.forEach(function(e){return e()})}}};n.query=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=n?function(t){for(var r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];return t.cachedQuery.apply(t,[n,e].concat(o))}:e,o=t;return o.query=e,o.cached=t,o.now=(0,r.compose)(p,t),o}},function(n,t){n.exports=e},function(e,t){e.exports=n}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tc2NvcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1zY29wZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ3VuLXNjb3BlL2V4dGVybmFsIFwicmFtZGFcIiIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvZXh0ZXJuYWwgXCJ6YWxnby1wcm9taXNlXCIiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9yYW1kYSIsIl96YWxnb1Byb21pc2UiLCJQcm9taXNlIiwiWmFsZ29Qcm9taXNlIiwiYWxsIiwicmVzb2x2ZSIsIm5vZGVLZXlzIiwib2JqIiwia2V5cyIsImZpbHRlciIsIm5vd09yIiwiY3VycnkiLCJkZWZhdWx0VmFsdWUiLCJwcm9taXNlIiwicmVzdWx0IiwicmVzb2x2ZWQiLCJ0aGVuIiwicmVzIiwibm93IiwidW5kZWZpbmVkIiwiYWNjZXNzIiwic2NvcGUiLCJ0aGlzYWNjZXNzIiwicGFjY2VzcyIsImFyZ3VtZW50cyIsImxlbmd0aCIsIkVycm9yIiwiY29uY2F0IiwiYWNjZXNzZXMiLCJmbiIsInBhcmVudGFjY2VzcyIsImRhdGEiLCJzb3VsIiwicGF0aCIsInZhbCIsInByb3AiLCJvayIsImZhaWwiLCJrbm93biIsImZldGNoIiwiY2F0Y2giLCJpZGVudGl0eSIsImdLZXkiLCJzb3VscyIsImNvdW50IiwiX3JlZiIsInRoaXNTY29wZSIsIl9yZWYkZ3JhcGgiLCJncmFwaCIsImRlZmF1bHRHcmFwaCIsImd1biIsInBhcmVudFNjb3BlIiwiX3JlZiR0aW1lb3V0IiwidGltZW91dCIsIl9yZWYkY2FjaGUiLCJjYWNoZSIsIl9yZWYkbm9HdW4iLCJub0d1biIsIl9yZWYkaXNDYWNoZWluZyIsImlzQ2FjaGVpbmciLCJfcmVmJGlzQ2FjaGVkIiwiaXNDYWNoZWQiLCJfcmVmJG9ubHlDYWNoZSIsIm9ubHlDYWNoZSIsImxpc3RlbmVycyIsImNhY2hlUHJvbWlzZXMiLCJwcm9taXNlcyIsImNhY2hlZFJlc3VsdHMiLCJsb2FkIiwiZXhpc3RpbmciLCJtZXJnZURlZXBSaWdodCIsImZvckVhY2giLCJvbiIsInB1c2giLCJvZmYiLCJ4IiwiZ2V0Q2FjaGUiLCJyZWFkVGltZW91dCIsInJlY2VpdmUiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiY29uc29sZSIsImxvZyIsImNhY2hlZFF1ZXJ5IiwicXVlcnlGbiIsIl9sZW4iLCJhcmdzIiwiQXJyYXkiLCJfa2V5IiwiYXBwbHkiLCJtYXAiLCJfdHlwZW9mIiwiSlNPTiIsInN0cmluZ2lmeSIsImNhY2hlZCIsImFzc29jUGF0aCIsImRpc3NvY1BhdGgiLCJnZXRHcmFwaCIsImdldEFjY2Vzc2VzIiwibG9hZENhY2hlZFJlc3VsdHMiLCJuZXdSZXN1bHRzIiwiZG9DYWNoZWRRdWVyeSIsInNjb3BlT2JqIiwiX2xlbjIiLCJfa2V5MiIsInF1ZXJ5IiwiY29tcG9zZSJdLCJtYXBwaW5ncyI6IkNBQUEs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Y0UsS0FDaEJNLEdBQWdCLEVBQUFuRSxFQUFBK0YsV0FBVXhHLEVBQUt1QixFQUFRcUQsSUFFekNGLEdBQWdCLEVBQUFqRSxFQUFBZ0csWUFBQWhHLEVBQUFpQyxLQUFpQmdDLEdBQzFCbkQsSUFHVCxPQUFPZ0YsRUFBU3pGLEVBQVFLLEVBQU1vRixFQUFRakYsSUFBWUEsR0FtQmxEc0MsY0FDQThDLFNBaEJlLGtCQUFNakQsR0FpQnJCa0QsWUFoQmtCLGtCQUFNdEUsR0FpQnhCd0MsT0FDQStCLGtCQWpCd0IsU0FBQUMsR0FDeEJqQyxHQUFnQixFQUFBbkUsRUFBQXNFLGdCQUFlSCxFQUFlaUMsR0FDOUNwQyxFQUFVTyxRQUFRLFNBQUExQyxHQUFFLE9BQUlBLGlCQW9CUCxTQUFDdUQsR0FBeUIsSUFBaEI3RyxFQUFnQmlELFVBQUFDLE9BQUEsUUFBQU4sSUFBQUssVUFBQSxHQUFBQSxVQUFBLEdBQVQsS0FHOUI2RSxFQUFnQjlILEVBRkYsU0FBQytILEdBQUQsUUFBQUMsRUFBQS9FLFVBQUFDLE9BQWM2RCxFQUFkLElBQUFDLE1BQUFnQixFQUFBLEVBQUFBLEVBQUEsS0FBQUMsRUFBQSxFQUFBQSxFQUFBRCxFQUFBQyxJQUFjbEIsRUFBZGtCLEVBQUEsR0FBQWhGLFVBQUFnRixHQUFBLE9BQ2xCRixFQUFTbkIsWUFBVE0sTUFBQWEsRUFBUSxDQUFhL0gsRUFBTTZHLEdBQW5CekQsT0FBK0IyRCxLQUNFRixFQUNyQ3RFLEVBQVN1RixFQVFmLE9BTkF2RixFQUFPMkYsTUFBUXJCLEVBQ2Z0RSxFQUFPZ0YsT0FBU08sRUFDaEJ2RixFQUFPSSxLQUFNLEVBQUFsQixFQUFBMEcsU0FDWHhGLEVBQ0FtRixHQUVLdkYsa0JDekxUekQsRUFBQUQsUUFBQU8saUJDQUFOLEVBQUFELFFBQUFRIiwiZmlsZSI6Imd1bi1zY29wZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoXCJyYW1kYVwiKSwgcmVxdWlyZShcInphbGdvLXByb21pc2VcIikpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoXCJndW4tc2NvcGVcIiwgW1wicmFtZGFcIiwgXCJ6YWxnby1wcm9taXNlXCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcImd1bi1zY29wZVwiXSA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwiemFsZ28tcHJvbWlzZVwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiZ3VuLXNjb3BlXCJdID0gZmFjdG9yeShyb290W1wicmFtZGFcIl0sIHJvb3RbXCJ6YWxnby1wcm9taXNlXCJdKTtcbn0pKHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzFfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiaW1wb3J0IHtcbiAgY29tcG9zZSxcbiAgZGlzc29jUGF0aCxcbiAgYXNzb2NQYXRoLFxuICBjdXJyeSxcbiAgcGF0aCxcbiAgcHJvcCxcbiAgbGVuZ3RoLFxuICBpZGVudGl0eSxcbiAgbWVyZ2VEZWVwUmlnaHRcbn0gZnJvbSBcInJhbWRhXCI7XG5pbXBvcnQgeyBaYWxnb1Byb21pc2UgfSBmcm9tIFwiemFsZ28tcHJvbWlzZVwiO1xuZXhwb3J0IGNvbnN0IFByb21pc2UgPSBaYWxnb1Byb21pc2U7XG5leHBvcnQgY29uc3QgeyBhbGwsIHJlc29sdmUgfSA9IFphbGdvUHJvbWlzZTtcblxuY29uc3Qgbm9kZUtleXMgPSBvYmogPT5cbiAgT2JqZWN0LmtleXMob2JqIHx8IHt9KS5maWx0ZXIoa2V5ID0+IGtleSAmJiBrZXkgIT09IFwiX1wiICYmIGtleSAhPT0gXCIjXCIpO1xuXG5leHBvcnQgY29uc3Qgbm93T3IgPSBjdXJyeSgoZGVmYXVsdFZhbHVlLCBwcm9taXNlKSA9PiB7XG4gIGxldCByZXN1bHQ7XG4gIGxldCByZXNvbHZlZDtcblxuICBwcm9taXNlLnRoZW4ocmVzID0+IHtcbiAgICByZXNvbHZlZCA9IHRydWU7XG4gICAgcmVzdWx0ID0gcmVzO1xuICB9KTtcbiAgcmV0dXJuIHJlc29sdmVkID8gcmVzdWx0IDogZGVmYXVsdFZhbHVlO1xufSk7XG5cbmV4cG9ydCBjb25zdCBub3cgPSBub3dPcih1bmRlZmluZWQpO1xuXG5jb25zdCBub2RlID0gKHNjb3BlLCBzb3VsKSA9PlxuICBuZXcgWmFsZ29Qcm9taXNlKChvaywgZmFpbCkgPT4ge1xuICAgIGNvbnN0IGtub3duID0gc2NvcGUua25vd24oc291bCk7XG5cbiAgICBpZiAodHlwZW9mIGtub3duICE9PSBcInVuZGVmaW5lZFwiKSBvayhrbm93bik7XG4gICAgc2NvcGVcbiAgICAgIC5mZXRjaChzb3VsKVxuICAgICAgLnRoZW4oKCkgPT4gc2NvcGUua25vd24oc291bCkpXG4gICAgICAudGhlbihvaylcbiAgICAgIC5jYXRjaChmYWlsKTtcbiAgfSk7XG5cbmNvbnN0IGVkZ2UgPSAoc2NvcGUsIGtleSwgcGFyZW50YWNjZXNzKSA9PlxuICBwYXJlbnRhY2Nlc3MudGhlbihkYXRhID0+IHtcbiAgICBjb25zdCBzb3VsID0gcGF0aChba2V5LCBcIiNcIl0sIGRhdGEpO1xuICAgIGNvbnN0IHZhbCA9IHByb3Aoa2V5LCBkYXRhKTtcblxuICAgIHJldHVybiBzb3VsID8gc2NvcGUuZ2V0KHNvdWwpLnRoZW4oKSA6IHZhbDtcbiAgfSk7XG5cbmNvbnN0IGFjY2VzcyA9IChzY29wZSwga2V5LCBwYWNjZXNzID0gbnVsbCkgPT4ge1xuICBpZiAoIWtleSB8fCBrZXkgPT09IFtdKSB0aHJvdyBuZXcgRXJyb3IoYGJhZCBrZXkgJHtrZXl9YCk7XG4gIGxldCB0aGlzYWNjZXNzO1xuICBjb25zdCBhY2Nlc3NlcyA9IHt9O1xuICBjb25zdCBnZXQgPSBnS2V5ID0+XG4gICAgYWNjZXNzZXNbZ0tleV0gfHwgKGFjY2Vzc2VzW2dLZXldID0gYWNjZXNzKHNjb3BlLCBnS2V5LCB0aGlzYWNjZXNzKSk7XG4gIGNvbnN0IHRoZW4gPSBmbiA9PlxuICAgIChwYWNjZXNzID8gZWRnZSA6IG5vZGUpKHNjb3BlLCBrZXksIHBhY2Nlc3MpLnRoZW4oZm4gfHwgaWRlbnRpdHkpO1xuICBjb25zdCBrZXlzID0gZm4gPT4gdGhlbihub2RlS2V5cykudGhlbihmbiB8fCBpZGVudGl0eSk7XG4gIGNvbnN0IGNvdW50ID0gZm4gPT4ga2V5cyhsZW5ndGgpLnRoZW4oZm4gfHwgaWRlbnRpdHkpO1xuXG4gIHRoaXNhY2Nlc3MgPSB7IGdldCwgdGhlbiwga2V5cywgc291bHM6IGtleXMsIGNvdW50IH07XG4gIHJldHVybiB0aGlzYWNjZXNzO1xufTtcblxuZXhwb3J0IGNvbnN0IHNjb3BlID0gKHtcbiAgZ3JhcGg6IGRlZmF1bHRHcmFwaCA9IHt9LFxuICBndW4sXG4gIHBhcmVudFNjb3BlLFxuICB0aW1lb3V0ID0gMTAwMDAsXG4gIGNhY2hlID0gbnVsbCxcbiAgZ2V0dGVyLFxuICBub0d1biA9IGZhbHNlLFxuICBpc0NhY2hlaW5nID0gZmFsc2UsXG4gIGlzQ2FjaGVkID0gZmFsc2UsXG4gIG9ubHlDYWNoZSA9IGZhbHNlXG59KSA9PiB7XG4gIGxldCB0aGlzU2NvcGU7XG4gIGxldCBsaXN0ZW5lcnMgPSBbXTtcbiAgbGV0IGNhY2hlUHJvbWlzZXMgPSB7fTtcbiAgbGV0IHByb21pc2VzID0ge307XG4gIGxldCBjYWNoZWRSZXN1bHRzID0geyAuLi4oY2FjaGUgfHwge30pIH07XG4gIGNvbnN0IGFjY2Vzc2VzID0ge307XG4gIGNvbnN0IGdyYXBoID0geyAuLi5kZWZhdWx0R3JhcGggfTtcbiAgY29uc3QgZ2V0ID0gc291bCA9PlxuICAgIGFjY2Vzc2VzW3NvdWxdIHx8IChhY2Nlc3Nlc1tzb3VsXSA9IGFjY2Vzcyh0aGlzU2NvcGUsIHNvdWwpKTtcbiAgY29uc3Qga25vd24gPSBzb3VsID0+IChwYXJlbnRTY29wZSA/IHBhcmVudFNjb3BlLmtub3duKHNvdWwpIDogZ3JhcGhbc291bF0pO1xuICBjb25zdCBvbiA9IGZuID0+IGxpc3RlbmVycy5wdXNoKGZuKTtcbiAgY29uc3Qgb2ZmID0gZm4gPT4gKGxpc3RlbmVycyA9IGxpc3RlbmVycy5maWx0ZXIoeCA9PiB4ICE9PSBmbikpO1xuXG4gIGNvbnN0IGxvYWQgPSAoc291bCwgZGF0YSkgPT4ge1xuICAgIGNvbnN0IGV4aXN0aW5nID0gZ3JhcGhbc291bF07XG4gICAgbGV0IHJlc3VsdCA9IGV4aXN0aW5nO1xuXG4gICAgaWYgKGRhdGEpIHJlc3VsdCA9IGV4aXN0aW5nID8gbWVyZ2VEZWVwUmlnaHQoZXhpc3RpbmcgfHwge30sIGRhdGEpIDogZGF0YTtcbiAgICBncmFwaFtzb3VsXSA9IHJlc3VsdCB8fCBncmFwaFtzb3VsXSB8fCBudWxsO1xuICAgIGxpc3RlbmVycy5mb3JFYWNoKGZuID0+IGZuKHNvdWwsIHJlc3VsdCkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgY29uc3QgZmV0Y2ggPSBzb3VsID0+XG4gICAgcGFyZW50U2NvcGVcbiAgICAgID8gcGFyZW50U2NvcGUuZmV0Y2goc291bClcbiAgICAgIDogKHByb21pc2VzW3NvdWxdID1cbiAgICAgICAgICBwcm9taXNlc1tzb3VsXSB8fFxuICAgICAgICAgIG5ldyBaYWxnb1Byb21pc2Uob2sgPT4ge1xuICAgICAgICAgICAgbGV0IHJlYWRUaW1lb3V0O1xuXG4gICAgICAgICAgICBpZiAoIWd1bikgcmV0dXJuIG9rKG51bGwpO1xuXG4gICAgICAgICAgICBjb25zdCByZWNlaXZlID0gZGF0YSA9PiB7XG4gICAgICAgICAgICAgIGNsZWFyVGltZW91dChyZWFkVGltZW91dCk7XG4gICAgICAgICAgICAgIG9rKGxvYWQoc291bCwgZGF0YSkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmVhZFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgaWYgKCEoc291bCBpbiBncmFwaCkpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInNsb3cgcXVlcnlcIiwgc291bCk7XG4gICAgICAgICAgICAgICAgcmVjZWl2ZShudWxsKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdGltZW91dCk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc291bCAhPT0gXCJzdHJpbmdcIikgdGhyb3cgbmV3IEVycm9yKGBiYWQgU09VTCAke3NvdWx9YCk7XG4gICAgICAgICAgICBpZiAoZ2V0dGVyKSBnZXR0ZXIoc291bCkudGhlbihyZWNlaXZlKTtcbiAgICAgICAgICAgIGlmICghbm9HdW4pIGd1bi5nZXQoc291bCkub24ocmVjZWl2ZSk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgIH0pKTtcblxuICBjb25zdCBjYWNoZWRRdWVyeSA9IChuYW1lLCBxdWVyeUZuLCAuLi5hcmdzKSA9PiB7XG4gICAgaWYgKHBhcmVudFNjb3BlKSByZXR1cm4gcGFyZW50U2NvcGUuY2FjaGVkUXVlcnkobmFtZSwgcXVlcnlGbiwgLi4uYXJncyk7XG4gICAgY29uc3Qga2V5ID0gW25hbWUsIC4uLmFyZ3NdLm1hcCh4ID0+XG4gICAgICB0eXBlb2YgeCA9PT0gXCJvYmplY3RcIiA/IEpTT04uc3RyaW5naWZ5KHgpIDogYCR7eH1gXG4gICAgKTtcbiAgICBjb25zdCBjYWNoZWQgPSBwYXRoKGtleSwgY2FjaGVkUmVzdWx0cyk7XG5cbiAgICBpZiAob25seUNhY2hlKSByZXR1cm4gcmVzb2x2ZShjYWNoZWQpO1xuICAgIGNvbnN0IHByb21pc2UgPSBxdWVyeUZuKHRoaXNTY29wZSwgLi4uYXJncykudGhlbihyZXN1bHQgPT4ge1xuICAgICAgaWYgKGlzQ2FjaGVpbmcgfHwgaXNDYWNoZWQpIHtcbiAgICAgICAgY2FjaGVkUmVzdWx0cyA9IGFzc29jUGF0aChrZXksIHJlc3VsdCwgY2FjaGVkUmVzdWx0cyk7XG4gICAgICB9XG4gICAgICBjYWNoZVByb21pc2VzID0gZGlzc29jUGF0aChwYXRoLCBjYWNoZVByb21pc2VzKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2FjaGVkID8gcmVzb2x2ZShub3dPcihjYWNoZWQsIHByb21pc2UpKSA6IHByb21pc2U7XG4gIH07XG5cbiAgY29uc3QgZ2V0Q2FjaGUgPSAoKSA9PiBjYWNoZWRSZXN1bHRzO1xuICBjb25zdCBnZXRHcmFwaCA9ICgpID0+IGdyYXBoO1xuICBjb25zdCBnZXRBY2Nlc3NlcyA9ICgpID0+IGFjY2Vzc2VzO1xuICBjb25zdCBsb2FkQ2FjaGVkUmVzdWx0cyA9IG5ld1Jlc3VsdHMgPT4ge1xuICAgIGNhY2hlZFJlc3VsdHMgPSBtZXJnZURlZXBSaWdodChjYWNoZWRSZXN1bHRzLCBuZXdSZXN1bHRzKTtcbiAgICBsaXN0ZW5lcnMuZm9yRWFjaChmbiA9PiBmbigpKTtcbiAgfTtcblxuICB0aGlzU2NvcGUgPSB7XG4gICAgb24sXG4gICAgb2ZmLFxuICAgIGdldCxcbiAgICBnZXRDYWNoZSxcbiAgICBrbm93bixcbiAgICBmZXRjaCxcbiAgICBjYWNoZWRRdWVyeSxcbiAgICBwYXJlbnRTY29wZSxcbiAgICBnZXRHcmFwaCxcbiAgICBnZXRBY2Nlc3NlcyxcbiAgICBsb2FkLFxuICAgIGxvYWRDYWNoZWRSZXN1bHRzXG4gIH07XG4gIHJldHVybiB0aGlzU2NvcGU7XG59O1xuXG5leHBvcnQgY29uc3QgcXVlcnkgPSAocXVlcnlGbiwgbmFtZSA9IG51bGwpID0+IHtcbiAgY29uc3QgY2FjaGVkUXVlcnkgPSAoc2NvcGVPYmosIC4uLmFyZ3MpID0+XG4gICAgc2NvcGVPYmouY2FjaGVkUXVlcnkobmFtZSwgcXVlcnlGbiwgLi4uYXJncyk7XG4gIGNvbnN0IGRvQ2FjaGVkUXVlcnkgPSBuYW1lID8gY2FjaGVkUXVlcnkgOiBxdWVyeUZuO1xuICBjb25zdCByZXN1bHQgPSBkb0NhY2hlZFF1ZXJ5O1xuXG4gIHJlc3VsdC5xdWVyeSA9IHF1ZXJ5Rm47XG4gIHJlc3VsdC5jYWNoZWQgPSBkb0NhY2hlZFF1ZXJ5O1xuICByZXN1bHQubm93ID0gY29tcG9zZShcbiAgICBub3csXG4gICAgZG9DYWNoZWRRdWVyeVxuICApO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fOyIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fOyJdLCJzb3VyY2VSb290IjoiIn0=
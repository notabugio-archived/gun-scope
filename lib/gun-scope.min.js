!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("ramda"),require("zalgo-promise")):"function"==typeof define&&define.amd?define("gun-scope",["ramda","zalgo-promise"],e):"object"==typeof exports?exports["gun-scope"]=e(require("ramda"),require("zalgo-promise")):n["gun-scope"]=e(n.ramda,n["zalgo-promise"])}("undefined"!=typeof self?self:this,function(n,e){return function(n){var e={};function t(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=n,t.c=e,t.d=function(n,e,r){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:r})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)t.d(r,o,function(e){return n[e]}.bind(null,o));return r},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=0)}([function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.query=e.scope=e.now=e.nowOr=e.resolve=e.all=e.Promise=void 0;var r=t(1),o=t(2);function u(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=[],r=!0,o=!1,u=void 0;try{for(var i,c=n[Symbol.iterator]();!(r=(i=c.next()).done)&&(t.push(i.value),!e||t.length!==e);r=!0);}catch(n){o=!0,u=n}finally{try{r||null==c.return||c.return()}finally{if(o)throw u}}return t}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(n){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}var c=o.ZalgoPromise;e.Promise=c;var a=o.ZalgoPromise.all,f=o.ZalgoPromise.resolve;e.resolve=f,e.all=a;var l=function(n){return Object.keys(n||{}).filter(function(n){return n&&"_"!==n&&"#"!==n})},p=(0,r.curry)(function(n,e){var t,r;return e.then(function(n){r=!0,t=n}),r?t:n});e.nowOr=p;var s=p(void 0);e.now=s;var y=function n(e,t){var u,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||t===[])throw new Error("bad key ".concat(t));var c={},a=function(n){return(i?function(n,e,t){return t.then(function(t){var o=(0,r.path)([e,"#"],t),u=(0,r.prop)(e,t);return o?n.get(o).then():u})}:function(n,e){return new o.ZalgoPromise(function(t,r){var o=n.known(e);void 0!==o&&t(o),n.fetch(e).then(function(){return n.known(e)}).then(t).catch(r)})})(e,t,i).then(n||r.identity)},f=function(n){return a(l).then(n||r.identity)};return u={get:function(t){return c[t]||(c[t]=n(e,t,u))},then:a,keys:f,souls:f,count:function(n){return f(r.length).then(n||r.identity)}}};e.scope=function(n){var e,t=n.graph,c=void 0===t?{}:t,a=n.gun,l=n.parentScope,s=n.timeout,d=void 0===s?1e4:s,h=n.cache,v=void 0===h?null:h,g=n.getter,m=n.noGun,b=void 0!==m&&m,w=n.isCacheing,P=void 0!==w&&w,S=n.isCached,j=void 0!==S&&S,O=n.onlyCache,x=void 0!==O&&O,q=[],_={},k={},A={...v||{}},C={},E={...c},M=function(n,e){var t=E[n],o=t;return e&&(o=t?(0,r.mergeDeepRight)(t||{},e):e),E[n]=o||E[n]||null,(0,r.equals)(t,o)||q.forEach(function(e){return e(n,o)}),o},Q=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];var u=[n].concat(t).map(function(n){return"object"===i(n)?JSON.stringify(n):"".concat(n)});return[(0,r.path)(u,A),u]},T=function(n,t){for(var o=arguments.length,i=new Array(o>2?o-2:0),c=2;c<o;c++)i[c-2]=arguments[c];if(l)return l.cacheQuery.apply(l,[n,t].concat(i));var a=u(Q.apply(void 0,[n].concat(i)),2),p=a[0],s=a[1];return x?f(p):t.apply(void 0,[e].concat(i)).then(function(n){return A=P?(0,r.assocPath)(s,n,A):(0,r.dissocPath)(s,A),_=(0,r.dissocPath)(r.path,_),n})};return e={on:function(n){return q.push(n)},off:function(n){return q=q.filter(function(e){return e!==n})},get:function(n){return C[n]||(C[n]=y(e,n))},getCache:function(){return A},known:function(n){return l?l.known(n):E[n]},fetch:function(n){return l?l.fetch(n):k[n]=k[n]||new o.ZalgoPromise(function(e){var t;if(!a)return e(null);var r=function(r){clearTimeout(t),e(M(n,r))};if(t=setTimeout(function(){n in E||(console.log("slow query",n),r(null))},d),"string"!=typeof n)throw new Error("bad SOUL ".concat(n));g&&g(n).then(r),b||a.get(n).on(r)})},cacheQuery:T,cachedQuery:function(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];if(l)return l.cachedQuery.apply(l,[n,e].concat(r));var i=u(Q.apply(void 0,[n].concat(r)),1)[0],c=T.apply(void 0,[n,e].concat(r));return j&&i?f(p(i,c)):c},parentScope:l,getGraph:function(){return E},getAccesses:function(){return C},load:M,loadCachedResults:function(n){A=(0,r.mergeDeepRight)(A,n),q.forEach(function(n){return n()})}}};e.query=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=function(t){for(var r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];return t.cachedQuery.apply(t,[e,n].concat(o))},o=e?t:n,u=e?t:n;return u.query=n,u.cached=o,u.now=(0,r.compose)(s,o),u}},function(e,t){e.exports=n},function(n,t){n.exports=e}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tc2NvcGUvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1zY29wZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ3VuLXNjb3BlL2V4dGVybmFsIFwicmFtZGFcIiIsIndlYnBhY2s6Ly9ndW4tc2NvcGUvZXh0ZXJuYWwgXCJ6YWxnby1wcm9taXNlXCIiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9yYW1kYSIsIl96YWxnb1Byb21pc2UiLCJQcm9taXNlIiwiWmFsZ29Qcm9taXNlIiwiYWxsIiwicmVzb2x2ZSIsIm5vZGVLZXlzIiwib2JqIiwia2V5cyIsImZpbHRlciIsIm5vd09yIiwiY3VycnkiLCJkZWZhdWx0VmFsdWUiLCJwcm9taXNlIiwicmVzdWx0IiwicmVzb2x2ZWQiLCJ0aGVuIiwicmVzIiwibm93IiwidW5kZWZpbmVkIiwiYWNjZXNzIiwic2NvcGUiLCJ0aGlzYWNjZXNzIiwicGFjY2VzcyIsImFyZ3VtZW50cyIsImxlbmd0aCIsIkVycm9yIiwiY29uY2F0IiwiYWNjZXNzZXMiLCJmbiIsInBhcmVudGFjY2VzcyIsImRhdGEiLCJzb3VsIiwicGF0aCIsInZhbCIsInByb3AiLCJvayIsImZhaWwiLCJrbm93biIsImZldGNoIiwiY2F0Y2giLCJpZGVudGl0eSIsImdLZXkiLCJzb3VscyIsImNvdW50IiwiX3JlZiIsInRoaXNTY29wZSIsIl9yZWYkZ3JhcGgiLCJncmFwaCIsImRlZmF1bHRHcmFwaCIsImd1biIsInBhcmVudFNjb3BlIiwiX3JlZiR0aW1lb3V0IiwidGltZW91dCIsIl9yZWYkY2FjaGUiLCJjYWNoZSIsIl9yZWYkbm9HdW4iLCJub0d1biIsIl9yZWYkaXNDYWNoZWluZyIsImlzQ2FjaGVpbmciLCJfcmVmJGlzQ2FjaGVkIiwiaXNDYWNoZWQiLCJfcmVmJG9ubHlDYWNoZSIsIm9ubHlDYWNoZSIsImxpc3RlbmVycyIsImNhY2hlUHJvbWlzZXMiLCJwcm9taXNlcyIsImNhY2hlZFJlc3VsdHMiLCJsb2FkIiwiZXhpc3RpbmciLCJtZXJnZURlZXBSaWdodCIsImVxdWFscyIsImZvckVhY2giLCJnZXRDYWNoZWQiLCJfbGVuIiwiYXJncyIsIkFycmF5IiwiX2tleSIsIm1hcCIsIngiLCJfdHlwZW9mIiwiSlNPTiIsInN0cmluZ2lmeSIsImNhY2hlUXVlcnkiLCJxdWVyeUZuIiwiX2xlbjIiLCJfa2V5MiIsImFwcGx5IiwiX2dldENhY2hlZDIiLCJfc2xpY2VkVG9BcnJheSIsImNhY2hlZCIsImFzc29jUGF0aCIsImRpc3NvY1BhdGgiLCJvbiIsInB1c2giLCJvZmYiLCJnZXRDYWNoZSIsInJlYWRUaW1lb3V0IiwicmVjZWl2ZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJjb25zb2xlIiwibG9nIiwiY2FjaGVkUXVlcnkiLCJfbGVuMyIsIl9rZXkzIiwiZ2V0R3JhcGgiLCJnZXRBY2Nlc3NlcyIsImxvYWRDYWNoZWRSZXN1bHRzIiwibmV3UmVzdWx0cyIsInNjb3BlT2JqIiwiX2xlbjQiLCJfa2V5NCIsImRvQ2FjaGVkUXVlcnkiLCJxdWVyeSIsImNvbXBvc2UiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsaUJBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELEVBQUFHLFFBQUEsU0FBQUEsUUFBQSxrQkFDQSxtQkFBQUMsZUFBQUMsSUFDQUQsT0FBQSxzQ0FBQUosR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxhQUFBRCxFQUFBRyxRQUFBLFNBQUFBLFFBQUEsa0JBRUFKLEVBQUEsYUFBQUMsRUFBQUQsRUFBQSxNQUFBQSxFQUFBLGtCQVJBLENBU0Msb0JBQUFPLFVBQUFDLEtBQUEsU0FBQUMsRUFBQUMsR0FDRCxtQkNUQSxJQUFBQyxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFYLFFBR0EsSUFBQUMsRUFBQVEsRUFBQUUsR0FBQSxDQUNBQyxFQUFBRCxFQUNBRSxHQUFBLEVBQ0FiLFFBQUEsSUFVQSxPQU5BYyxFQUFBSCxHQUFBSSxLQUFBZCxFQUFBRCxRQUFBQyxJQUFBRCxRQUFBVSxHQUdBVCxFQUFBWSxHQUFBLEVBR0FaLEVBQUFELFFBMERBLE9BckRBVSxFQUFBTSxFQUFBRixFQUdBSixFQUFBTyxFQUFBUixFQUdBQyxFQUFBUSxFQUFBLFNBQUFsQixFQUFBbUIsRUFBQUMsR0FDQVYsRUFBQVcsRUFBQXJCLEVBQUFtQixJQUNBRyxPQUFBQyxlQUFBdkIsRUFBQW1CLEVBQUEsQ0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNWLEVBQUFnQixFQUFBLFNBQUExQixHQUNBLG9CQUFBMkIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQXZCLEVBQUEyQixPQUFBQyxZQUFBLENBQXdEQyxNQUFBLFdBRXhEUCxPQUFBQyxlQUFBdkIsRUFBQSxjQUFpRDZCLE9BQUEsS0FRakRuQixFQUFBb0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEs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QVFLLEVBQU1nRixFQUFRN0UsSUFEaEJBLEdBcUJ0QnNDLGNBQ0F1RCxTQWpCZSxrQkFBTTFELEdBa0JyQjJELFlBakJrQixrQkFBTS9FLEdBa0J4QndDLE9BQ0F3QyxrQkFsQndCLFNBQUFDLEdBQ3hCMUMsR0FBZ0IsRUFBQW5FLEVBQUFzRSxnQkFBZUgsRUFBZTBDLEdBQzlDN0MsRUFBVVEsUUFBUSxTQUFBM0MsR0FBRSxPQUFJQSxpQkFxQlAsU0FBQ3VELEdBQXlCLElBQWhCN0csRUFBZ0JpRCxVQUFBQyxPQUFBLFFBQUFOLElBQUFLLFVBQUEsR0FBQUEsVUFBQSxHQUFULEtBQzlCK0UsRUFBYyxTQUFDTyxHQUFELFFBQUFDLEVBQUF2RixVQUFBQyxPQUFja0QsRUFBZCxJQUFBQyxNQUFBbUMsRUFBQSxFQUFBQSxFQUFBLEtBQUFDLEVBQUEsRUFBQUEsRUFBQUQsRUFBQUMsSUFBY3JDLEVBQWRxQyxFQUFBLEdBQUF4RixVQUFBd0YsR0FBQSxPQUNsQkYsRUFBU1AsWUFBVGhCLE1BQUF1QixFQUFRLENBQWF2SSxFQUFNNkcsR0FBbkJ6RCxPQUErQmdELEtBQ25Dc0MsRUFBZ0IxSSxFQUFPZ0ksRUFBY25CLEVBQ3JDdEUsRUFBU3ZDLEVBQU9nSSxFQUFjbkIsRUFRcEMsT0FOQXRFLEVBQU9vRyxNQUFROUIsRUFDZnRFLEVBQU80RSxPQUFTdUIsRUFDaEJuRyxFQUFPSSxLQUFNLEVBQUFsQixFQUFBbUgsU0FDWGpHLEVBQ0ErRixHQUVLbkcsa0JDMU1UekQsRUFBQUQsUUFBQU8saUJDQUFOLEVBQUFELFFBQUFRIiwiZmlsZSI6Imd1bi1zY29wZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoXCJyYW1kYVwiKSwgcmVxdWlyZShcInphbGdvLXByb21pc2VcIikpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoXCJndW4tc2NvcGVcIiwgW1wicmFtZGFcIiwgXCJ6YWxnby1wcm9taXNlXCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcImd1bi1zY29wZVwiXSA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwiemFsZ28tcHJvbWlzZVwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiZ3VuLXNjb3BlXCJdID0gZmFjdG9yeShyb290W1wicmFtZGFcIl0sIHJvb3RbXCJ6YWxnby1wcm9taXNlXCJdKTtcbn0pKHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzFfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiaW1wb3J0IHtcbiAgY29tcG9zZSxcbiAgZXF1YWxzLFxuICBkaXNzb2NQYXRoLFxuICBhc3NvY1BhdGgsXG4gIGN1cnJ5LFxuICBwYXRoLFxuICBwcm9wLFxuICBsZW5ndGgsXG4gIGlkZW50aXR5LFxuICBtZXJnZURlZXBSaWdodFxufSBmcm9tIFwicmFtZGFcIjtcbmltcG9ydCB7IFphbGdvUHJvbWlzZSB9IGZyb20gXCJ6YWxnby1wcm9taXNlXCI7XG5leHBvcnQgY29uc3QgUHJvbWlzZSA9IFphbGdvUHJvbWlzZTtcbmV4cG9ydCBjb25zdCB7IGFsbCwgcmVzb2x2ZSB9ID0gWmFsZ29Qcm9taXNlO1xuXG5jb25zdCBub2RlS2V5cyA9IG9iaiA9PlxuICBPYmplY3Qua2V5cyhvYmogfHwge30pLmZpbHRlcihrZXkgPT4ga2V5ICYmIGtleSAhPT0gXCJfXCIgJiYga2V5ICE9PSBcIiNcIik7XG5cbmV4cG9ydCBjb25zdCBub3dPciA9IGN1cnJ5KChkZWZhdWx0VmFsdWUsIHByb21pc2UpID0+IHtcbiAgbGV0IHJlc3VsdDtcbiAgbGV0IHJlc29sdmVkO1xuXG4gIHByb21pc2UudGhlbihyZXMgPT4ge1xuICAgIHJlc29sdmVkID0gdHJ1ZTtcbiAgICByZXN1bHQgPSByZXM7XG4gIH0pO1xuICByZXR1cm4gcmVzb2x2ZWQgPyByZXN1bHQgOiBkZWZhdWx0VmFsdWU7XG59KTtcblxuZXhwb3J0IGNvbnN0IG5vdyA9IG5vd09yKHVuZGVmaW5lZCk7XG5cbmNvbnN0IG5vZGUgPSAoc2NvcGUsIHNvdWwpID0+XG4gIG5ldyBaYWxnb1Byb21pc2UoKG9rLCBmYWlsKSA9PiB7XG4gICAgY29uc3Qga25vd24gPSBzY29wZS5rbm93bihzb3VsKTtcblxuICAgIGlmICh0eXBlb2Yga25vd24gIT09IFwidW5kZWZpbmVkXCIpIG9rKGtub3duKTtcbiAgICBzY29wZVxuICAgICAgLmZldGNoKHNvdWwpXG4gICAgICAudGhlbigoKSA9PiBzY29wZS5rbm93bihzb3VsKSlcbiAgICAgIC50aGVuKG9rKVxuICAgICAgLmNhdGNoKGZhaWwpO1xuICB9KTtcblxuY29uc3QgZWRnZSA9IChzY29wZSwga2V5LCBwYXJlbnRhY2Nlc3MpID0+XG4gIHBhcmVudGFjY2Vzcy50aGVuKGRhdGEgPT4ge1xuICAgIGNvbnN0IHNvdWwgPSBwYXRoKFtrZXksIFwiI1wiXSwgZGF0YSk7XG4gICAgY29uc3QgdmFsID0gcHJvcChrZXksIGRhdGEpO1xuXG4gICAgcmV0dXJuIHNvdWwgPyBzY29wZS5nZXQoc291bCkudGhlbigpIDogdmFsO1xuICB9KTtcblxuY29uc3QgYWNjZXNzID0gKHNjb3BlLCBrZXksIHBhY2Nlc3MgPSBudWxsKSA9PiB7XG4gIGlmICgha2V5IHx8IGtleSA9PT0gW10pIHRocm93IG5ldyBFcnJvcihgYmFkIGtleSAke2tleX1gKTtcbiAgbGV0IHRoaXNhY2Nlc3M7XG4gIGNvbnN0IGFjY2Vzc2VzID0ge307XG4gIGNvbnN0IGdldCA9IGdLZXkgPT5cbiAgICBhY2Nlc3Nlc1tnS2V5XSB8fCAoYWNjZXNzZXNbZ0tleV0gPSBhY2Nlc3Moc2NvcGUsIGdLZXksIHRoaXNhY2Nlc3MpKTtcbiAgY29uc3QgdGhlbiA9IGZuID0+XG4gICAgKHBhY2Nlc3MgPyBlZGdlIDogbm9kZSkoc2NvcGUsIGtleSwgcGFjY2VzcykudGhlbihmbiB8fCBpZGVudGl0eSk7XG4gIGNvbnN0IGtleXMgPSBmbiA9PiB0aGVuKG5vZGVLZXlzKS50aGVuKGZuIHx8IGlkZW50aXR5KTtcbiAgY29uc3QgY291bnQgPSBmbiA9PiBrZXlzKGxlbmd0aCkudGhlbihmbiB8fCBpZGVudGl0eSk7XG5cbiAgdGhpc2FjY2VzcyA9IHsgZ2V0LCB0aGVuLCBrZXlzLCBzb3Vsczoga2V5cywgY291bnQgfTtcbiAgcmV0dXJuIHRoaXNhY2Nlc3M7XG59O1xuXG5leHBvcnQgY29uc3Qgc2NvcGUgPSAoe1xuICBncmFwaDogZGVmYXVsdEdyYXBoID0ge30sXG4gIGd1bixcbiAgcGFyZW50U2NvcGUsXG4gIHRpbWVvdXQgPSAxMDAwMCxcbiAgY2FjaGUgPSBudWxsLFxuICBnZXR0ZXIsXG4gIG5vR3VuID0gZmFsc2UsXG4gIGlzQ2FjaGVpbmcgPSBmYWxzZSxcbiAgaXNDYWNoZWQgPSBmYWxzZSxcbiAgb25seUNhY2hlID0gZmFsc2Vcbn0pID0+IHtcbiAgbGV0IHRoaXNTY29wZTtcbiAgbGV0IGxpc3RlbmVycyA9IFtdO1xuICBsZXQgY2FjaGVQcm9taXNlcyA9IHt9O1xuICBsZXQgcHJvbWlzZXMgPSB7fTtcbiAgbGV0IGNhY2hlZFJlc3VsdHMgPSB7IC4uLihjYWNoZSB8fCB7fSkgfTtcbiAgY29uc3QgYWNjZXNzZXMgPSB7fTtcbiAgY29uc3QgZ3JhcGggPSB7IC4uLmRlZmF1bHRHcmFwaCB9O1xuICBjb25zdCBnZXQgPSBzb3VsID0+XG4gICAgYWNjZXNzZXNbc291bF0gfHwgKGFjY2Vzc2VzW3NvdWxdID0gYWNjZXNzKHRoaXNTY29wZSwgc291bCkpO1xuICBjb25zdCBrbm93biA9IHNvdWwgPT4gKHBhcmVudFNjb3BlID8gcGFyZW50U2NvcGUua25vd24oc291bCkgOiBncmFwaFtzb3VsXSk7XG4gIGNvbnN0IG9uID0gZm4gPT4gbGlzdGVuZXJzLnB1c2goZm4pO1xuICBjb25zdCBvZmYgPSBmbiA9PiAobGlzdGVuZXJzID0gbGlzdGVuZXJzLmZpbHRlcih4ID0+IHggIT09IGZuKSk7XG5cbiAgY29uc3QgbG9hZCA9IChzb3VsLCBkYXRhKSA9PiB7XG4gICAgY29uc3QgZXhpc3RpbmcgPSBncmFwaFtzb3VsXTtcbiAgICBsZXQgcmVzdWx0ID0gZXhpc3Rpbmc7XG5cbiAgICBpZiAoZGF0YSkgcmVzdWx0ID0gZXhpc3RpbmcgPyBtZXJnZURlZXBSaWdodChleGlzdGluZyB8fCB7fSwgZGF0YSkgOiBkYXRhO1xuICAgIGdyYXBoW3NvdWxdID0gcmVzdWx0IHx8IGdyYXBoW3NvdWxdIHx8IG51bGw7XG4gICAgaWYgKCFlcXVhbHMoZXhpc3RpbmcsIHJlc3VsdCkpIGxpc3RlbmVycy5mb3JFYWNoKGZuID0+IGZuKHNvdWwsIHJlc3VsdCkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgY29uc3QgZmV0Y2ggPSBzb3VsID0+XG4gICAgcGFyZW50U2NvcGVcbiAgICAgID8gcGFyZW50U2NvcGUuZmV0Y2goc291bClcbiAgICAgIDogKHByb21pc2VzW3NvdWxdID1cbiAgICAgICAgICBwcm9taXNlc1tzb3VsXSB8fFxuICAgICAgICAgIG5ldyBaYWxnb1Byb21pc2Uob2sgPT4ge1xuICAgICAgICAgICAgbGV0IHJlYWRUaW1lb3V0O1xuXG4gICAgICAgICAgICBpZiAoIWd1bikgcmV0dXJuIG9rKG51bGwpO1xuXG4gICAgICAgICAgICBjb25zdCByZWNlaXZlID0gZGF0YSA9PiB7XG4gICAgICAgICAgICAgIGNsZWFyVGltZW91dChyZWFkVGltZW91dCk7XG4gICAgICAgICAgICAgIG9rKGxvYWQoc291bCwgZGF0YSkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmVhZFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgaWYgKCEoc291bCBpbiBncmFwaCkpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInNsb3cgcXVlcnlcIiwgc291bCk7XG4gICAgICAgICAgICAgICAgcmVjZWl2ZShudWxsKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdGltZW91dCk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc291bCAhPT0gXCJzdHJpbmdcIikgdGhyb3cgbmV3IEVycm9yKGBiYWQgU09VTCAke3NvdWx9YCk7XG4gICAgICAgICAgICBpZiAoZ2V0dGVyKSBnZXR0ZXIoc291bCkudGhlbihyZWNlaXZlKTtcbiAgICAgICAgICAgIGlmICghbm9HdW4pIGd1bi5nZXQoc291bCkub24ocmVjZWl2ZSk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgIH0pKTtcblxuICBjb25zdCBnZXRDYWNoZWQgPSAobmFtZSwgLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IGtleSA9IFtuYW1lLCAuLi5hcmdzXS5tYXAoeCA9PlxuICAgICAgdHlwZW9mIHggPT09IFwib2JqZWN0XCIgPyBKU09OLnN0cmluZ2lmeSh4KSA6IGAke3h9YFxuICAgICk7XG5cbiAgICByZXR1cm4gW3BhdGgoa2V5LCBjYWNoZWRSZXN1bHRzKSwga2V5XTtcbiAgfTtcblxuICBjb25zdCBjYWNoZVF1ZXJ5ID0gKG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpID0+IHtcbiAgICBpZiAocGFyZW50U2NvcGUpIHJldHVybiBwYXJlbnRTY29wZS5jYWNoZVF1ZXJ5KG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpO1xuICAgIGNvbnN0IFtjYWNoZWQsIGtleV0gPSBnZXRDYWNoZWQobmFtZSwgLi4uYXJncyk7XG5cbiAgICBpZiAob25seUNhY2hlKSByZXR1cm4gcmVzb2x2ZShjYWNoZWQpO1xuICAgIHJldHVybiBxdWVyeUZuKHRoaXNTY29wZSwgLi4uYXJncykudGhlbihyZXN1bHQgPT4ge1xuICAgICAgaWYgKGlzQ2FjaGVpbmcpIHtcbiAgICAgICAgY2FjaGVkUmVzdWx0cyA9IGFzc29jUGF0aChrZXksIHJlc3VsdCwgY2FjaGVkUmVzdWx0cyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWNoZWRSZXN1bHRzID0gZGlzc29jUGF0aChrZXksIGNhY2hlZFJlc3VsdHMpO1xuICAgICAgfVxuICAgICAgY2FjaGVQcm9taXNlcyA9IGRpc3NvY1BhdGgocGF0aCwgY2FjaGVQcm9taXNlcyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGNhY2hlZFF1ZXJ5ID0gKG5hbWUsIHF1ZXJ5Rm4sIC4uLmFyZ3MpID0+IHtcbiAgICBpZiAocGFyZW50U2NvcGUpIHJldHVybiBwYXJlbnRTY29wZS5jYWNoZWRRdWVyeShuYW1lLCBxdWVyeUZuLCAuLi5hcmdzKTtcbiAgICBjb25zdCBbY2FjaGVkXSA9IGdldENhY2hlZChuYW1lLCAuLi5hcmdzKTtcbiAgICBjb25zdCBwcm9taXNlID0gY2FjaGVRdWVyeShuYW1lLCBxdWVyeUZuLCAuLi5hcmdzKTtcblxuICAgIC8vIGlmICghY2FjaGVkICYmIGlzQ2FjaGVkKSBjb25zb2xlLmxvZyhcImNhY2hlIG1pc3NcIiwgbmFtZSwgYXJncyk7XG4gICAgaWYgKCFpc0NhY2hlZCkgcmV0dXJuIHByb21pc2U7XG4gICAgcmV0dXJuIGNhY2hlZCA/IHJlc29sdmUobm93T3IoY2FjaGVkLCBwcm9taXNlKSkgOiBwcm9taXNlO1xuICB9O1xuXG4gIGNvbnN0IGdldENhY2hlID0gKCkgPT4gY2FjaGVkUmVzdWx0cztcbiAgY29uc3QgZ2V0R3JhcGggPSAoKSA9PiBncmFwaDtcbiAgY29uc3QgZ2V0QWNjZXNzZXMgPSAoKSA9PiBhY2Nlc3NlcztcbiAgY29uc3QgbG9hZENhY2hlZFJlc3VsdHMgPSBuZXdSZXN1bHRzID0+IHtcbiAgICBjYWNoZWRSZXN1bHRzID0gbWVyZ2VEZWVwUmlnaHQoY2FjaGVkUmVzdWx0cywgbmV3UmVzdWx0cyk7XG4gICAgbGlzdGVuZXJzLmZvckVhY2goZm4gPT4gZm4oKSk7XG4gIH07XG5cbiAgdGhpc1Njb3BlID0ge1xuICAgIG9uLFxuICAgIG9mZixcbiAgICBnZXQsXG4gICAgZ2V0Q2FjaGUsXG4gICAga25vd24sXG4gICAgZmV0Y2gsXG4gICAgY2FjaGVRdWVyeSxcbiAgICBjYWNoZWRRdWVyeSxcbiAgICBwYXJlbnRTY29wZSxcbiAgICBnZXRHcmFwaCxcbiAgICBnZXRBY2Nlc3NlcyxcbiAgICBsb2FkLFxuICAgIGxvYWRDYWNoZWRSZXN1bHRzXG4gIH07XG4gIHJldHVybiB0aGlzU2NvcGU7XG59O1xuXG5leHBvcnQgY29uc3QgcXVlcnkgPSAocXVlcnlGbiwgbmFtZSA9IG51bGwpID0+IHtcbiAgY29uc3QgY2FjaGVkUXVlcnkgPSAoc2NvcGVPYmosIC4uLmFyZ3MpID0+XG4gICAgc2NvcGVPYmouY2FjaGVkUXVlcnkobmFtZSwgcXVlcnlGbiwgLi4uYXJncyk7XG4gIGNvbnN0IGRvQ2FjaGVkUXVlcnkgPSBuYW1lID8gY2FjaGVkUXVlcnkgOiBxdWVyeUZuO1xuICBjb25zdCByZXN1bHQgPSBuYW1lID8gY2FjaGVkUXVlcnkgOiBxdWVyeUZuO1xuXG4gIHJlc3VsdC5xdWVyeSA9IHF1ZXJ5Rm47XG4gIHJlc3VsdC5jYWNoZWQgPSBkb0NhY2hlZFF1ZXJ5O1xuICByZXN1bHQubm93ID0gY29tcG9zZShcbiAgICBub3csXG4gICAgZG9DYWNoZWRRdWVyeVxuICApO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fOyIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fOyJdLCJzb3VyY2VSb290IjoiIn0=